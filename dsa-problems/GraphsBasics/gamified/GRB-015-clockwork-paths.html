<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRB-015: Clockwork Paths</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #1a1a2e; --brass: #b8860b; --copper: #cd7f32; --steel: #708090; --text: #ddd; }
        * { box-sizing: border-box; }
        body { font-family: 'Share Tech Mono', monospace; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; display: flex; flex-direction: column; }
        header { background: #0f0f1a; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--brass); }
        h1 { margin: 0; font-family: 'Cinzel', serif; color: var(--brass); font-size: 1.8rem; }
        main { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 1rem; gap: 12px; }
        .instructions { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 8px; text-align: center; max-width: 750px; border: 2px solid var(--brass); font-size: 0.9rem; }
        .instructions b { color: var(--brass); }
        .game-container { display: flex; gap: 15px; align-items: flex-start; }
        .clockwork-board { position: relative; width: 400px; height: 350px; background: radial-gradient(circle, #2a2a4a, #1a1a2e); border-radius: 15px; border: 3px solid var(--brass); }
        .gear { position: absolute; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; z-index: 10; border: 3px solid var(--steel); background: var(--copper); transition: all 0.2s; }
        .gear:hover { transform: scale(1.15) rotate(15deg); }
        .gear.selected { box-shadow: 0 0 20px var(--brass); border-color: var(--brass); }
        .pipe-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .pipe-svg line { stroke: var(--steel); stroke-width: 3; }
        .weight-label { position: absolute; background: #000; color: var(--brass); padding: 1px 5px; border-radius: 8px; font-size: 0.65rem; transform: translate(-50%,-50%); z-index: 11; }
        .matrix-panel { background: rgba(0,0,0,0.4); border: 2px solid var(--brass); border-radius: 10px; padding: 10px; }
        .matrix-title { font-family: 'Cinzel'; color: var(--brass); text-align: center; margin-bottom: 8px; font-size: 0.9rem; }
        .matrix-table { border-collapse: collapse; font-size: 0.7rem; }
        .matrix-table td, .matrix-table th { border: 1px solid var(--steel); padding: 4px 8px; text-align: center; min-width: 30px; }
        .matrix-table th { background: var(--brass); color: #000; }
        .matrix-table td.updated { background: rgba(184,134,11,0.3); animation: flash 0.5s; }
        @keyframes flash { 0%{background:var(--brass)} 100%{background:transparent} }
        .btn { background: var(--brass); color: #000; border: none; padding: 10px 20px; font-family: 'Cinzel'; cursor: pointer; border-radius: 5px; }
        .btn:hover { background: var(--copper); }
        .btn.secondary { background: transparent; border: 2px solid var(--steel); color: var(--steel); }
        #status { font-size: 0.9rem; text-align: center; min-height: 25px; color: var(--brass); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .modal.hidden { display: none; }
        .dialog { background: var(--bg); padding: 25px; border: 3px solid var(--brass); max-width: 500px; text-align: center; border-radius: 12px; }
        .dialog h2 { color: var(--brass); font-family: 'Cinzel'; }
    </style>
</head>
<body>
<header>
    <h1>‚öôÔ∏è CLOCKWORK PATHS</h1>
    <div style="color:#888">FLOYD-WARSHALL</div>
</header>
<main>
    <div class="instructions">
        <b>üéØ ALL-PAIRS SHORTEST PATHS:</b> Click two gears to query the shortest path. 
        Then run Floyd-Warshall iterations to compute ALL paths at once!
    </div>
    <div class="game-container">
        <div class="clockwork-board" id="board">
            <svg class="pipe-svg" id="pipeSvg"></svg>
        </div>
        <div class="matrix-panel">
            <div class="matrix-title">DISTANCE MATRIX</div>
            <table class="matrix-table" id="distMatrix"></table>
        </div>
    </div>
    <div id="status">Click two gears to query distance, or run Floyd-Warshall!</div>
    <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button class="btn" onclick="game.step()">STEP (k=<span id="kVal">0</span>)</button>
        <button class="btn" onclick="game.autoRun()">AUTO RUN</button>
        <button class="btn secondary" onclick="game.reset()">RESET</button>
        <button class="btn secondary" onclick="game.newGame()">NEW GRAPH</button>
    </div>
</main>
<div id="modal" class="modal">
    <div class="dialog">
        <h2>‚öôÔ∏è CLOCKWORK PATHS</h2>
        <div style="margin:15px 0; text-align:left; line-height:1.7; font-size:0.9rem;">
            <p><b style="color:var(--brass)">GOAL:</b> Compute shortest paths between ALL pairs!</p>
            <ul>
                <li>Click two gears to query current shortest path</li>
                <li>Press <b>STEP</b> to consider using gear k as intermediate</li>
                <li>Watch the distance matrix update!</li>
                <li>After N steps, all shortest paths are found!</li>
            </ul>
            <p style="color:#888">Floyd-Warshall: dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])</p>
        </div>
        <button class="btn" onclick="game.start()">ENGAGE GEARS</button>
    </div>
</div>
<script>
class Game {
    constructor() {
        this.nodes=[]; this.edges=[]; this.dist=[]; this.k=0; this.n=0; this.selected=[];
        this.ui = { board:document.getElementById('board'), svg:document.getElementById('pipeSvg'), matrix:document.getElementById('distMatrix'), kVal:document.getElementById('kVal'), status:document.getElementById('status'), modal:document.getElementById('modal') };
    }
    start() { this.ui.modal.classList.add('hidden'); this.newGame(); }
    newGame() {
        this.n = Math.floor(Math.random()*2)+5;
        this.nodes=[];
        const cx=200, cy=175, r=120;
        for(let i=0;i<this.n;i++) {
            const angle=(2*Math.PI*i)/this.n - Math.PI/2;
            this.nodes.push({id:i, x:cx+r*Math.cos(angle), y:cy+r*Math.sin(angle)});
        }
        this.edges=[];
        // Create connected weighted graph
        for(let i=0;i<this.n;i++) {
            for(let j=i+1;j<this.n;j++) {
                if(Math.random()>0.4 || j===i+1) {
                    const w=Math.floor(Math.random()*9)+1;
                    this.edges.push({u:i,v:j,w});
                }
            }
        }
        this.reset();
    }
    reset() {
        const INF=999;
        this.dist=Array.from({length:this.n},(_,i)=>Array.from({length:this.n},(_,j)=>i===j?0:INF));
        for(const e of this.edges) { this.dist[e.u][e.v]=e.w; this.dist[e.v][e.u]=e.w; }
        this.k=0; this.selected=[]; this.ui.status.textContent='Ready! Click STEP to use k=0 as intermediate.'; this.render();
    }
    clickGear(id) {
        if(this.selected.length<2 && !this.selected.includes(id)) { this.selected.push(id); }
        else { this.selected=[id]; }
        if(this.selected.length===2) {
            const [i,j]=this.selected;
            const d=this.dist[i][j];
            this.ui.status.innerHTML=d>=999?`No path from ${i} to ${j}`:`Shortest ${i}‚Üí${j}: <b>${d}</b>`;
        }
        this.render();
    }
    step() {
        if(this.k>=this.n) { this.ui.status.textContent='‚úÖ Algorithm complete! All shortest paths computed.'; return false; }
        const k=this.k;
        for(let i=0;i<this.n;i++) {
            for(let j=0;j<this.n;j++) {
                if(this.dist[i][k]+this.dist[k][j]<this.dist[i][j]) {
                    this.dist[i][j]=this.dist[i][k]+this.dist[k][j];
                }
            }
        }
        this.k++;
        this.ui.status.textContent=`Processed k=${k}. Now considering paths through gears 0..${this.k-1}`;
        this.render();
        return this.k<this.n;
    }
    autoRun() {
        const interval=setInterval(()=>{ if(!this.step()) clearInterval(interval); }, 600);
    }
    render() {
        this.ui.board.querySelectorAll('.gear,.weight-label').forEach(n=>n.remove());
        this.ui.svg.innerHTML='';
        // Draw pipes
        for(const e of this.edges) {
            const u=this.nodes[e.u], v=this.nodes[e.v];
            const line=document.createElementNS('http://www.w3.org/2000/svg','line');
            line.setAttribute('x1',u.x); line.setAttribute('y1',u.y);
            line.setAttribute('x2',v.x); line.setAttribute('y2',v.y);
            this.ui.svg.appendChild(line);
            const lbl=document.createElement('div');
            lbl.className='weight-label';
            lbl.textContent=e.w;
            lbl.style.left=(u.x+v.x)/2+'px'; lbl.style.top=(u.y+v.y)/2+'px';
            this.ui.board.appendChild(lbl);
        }
        // Draw gears
        for(const n of this.nodes) {
            const el=document.createElement('div');
            el.className='gear';
            if(this.selected.includes(n.id)) el.classList.add('selected');
            el.style.left=(n.x-22)+'px'; el.style.top=(n.y-22)+'px';
            el.textContent=n.id;
            el.onclick=()=>this.clickGear(n.id);
            this.ui.board.appendChild(el);
        }
        // Update matrix
        let html='<tr><th></th>';
        for(let j=0;j<this.n;j++) html+=`<th>${j}</th>`;
        html+='</tr>';
        for(let i=0;i<this.n;i++) {
            html+=`<tr><th>${i}</th>`;
            for(let j=0;j<this.n;j++) {
                const d=this.dist[i][j];
                html+=`<td>${d>=999?'‚àû':d}</td>`;
            }
            html+='</tr>';
        }
        this.ui.matrix.innerHTML=html;
        this.ui.kVal.textContent=this.k;
    }
}
const game=new Game();
</script>
</body>
</html>
