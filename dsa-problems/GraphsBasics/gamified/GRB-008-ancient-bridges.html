<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRB-008: Ancient Bridges</title>
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #2d241e;
            --stone: #5c4b3a;
            --moss: #687d47;
            --water: #3a5b6e;
            --ancient-gold: #c5a059;
            --text: #d2cabb;
            --highlight: #e0d5c0;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            user-select: none;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0,0,0,0.2) 0%, transparent 100%),
                url('https://www.transparenttextures.com/patterns/dark-leather.png');
        }

        header {
            background: var(--stone);
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 5px solid var(--ancient-gold);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        h1 { 
            margin: 0; 
            font-family: 'Uncial Antiqua', cursive; 
            color: var(--ancient-gold); 
            font-size: 1.8rem;
            text-shadow: 2px 2px 2px #000;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            gap: 20px;
        }

        .map-container {
            position: relative;
            width: 700px;
            height: 450px;
            background-color: var(--moss);
            background-image: url('https://www.transparenttextures.com/patterns/handmade-paper.png');
            border: 10px solid var(--stone);
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .ruin {
            position: absolute;
            width: 50px;
            height: 50px;
            background: var(--stone);
            border: 2px solid var(--ancient-gold);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.5);
            font-family: 'Uncial Antiqua';
        }

        .ruin:hover { transform: translateY(-5px); border-color: #fff; }
        .ruin.in-tree { background: var(--ancient-gold); color: #000; box-shadow: 0 0 20px var(--ancient-gold); }
        .ruin.exploring { border-color: #fff; animation: pulse 1s infinite; }

        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .bridge-path {
            position: absolute;
            height: 6px;
            background: rgba(0,0,0,0.2);
            transform-origin: left center;
            pointer-events: none;
            z-index: 5;
        }
        .bridge-path.built { background: var(--ancient-gold); height: 8px; box-shadow: 0 0 12px var(--ancient-gold); z-index: 6; }
        .bridge-path.potential { background: #fff; opacity: 0.4; stroke-dasharray: 5,5; }

        .cost-marker {
            position: absolute;
            background: var(--stone);
            color: var(--ancient-gold);
            padding: 1px 5px;
            font-size: 0.75rem;
            border: 1px solid var(--ancient-gold);
            transform: translate(-50%, -50%);
            z-index: 11;
            font-family: 'Uncial Antiqua';
        }

        .priority-queue {
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            width: 200px;
            position: absolute;
            right: 10px; top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--ancient-gold);
            z-index: 12;
        }

        .pq-item {
            display: flex; justify-content: space-between;
            padding: 2px 8px;
            border-bottom: 1px solid rgba(197, 160, 89, 0.2);
            font-size: 0.75rem;
        }

        .stats-panel {
            display: flex;
            gap: 25px;
            padding: 15px 30px;
            background: var(--stone);
            border-radius: 4px;
            border: 1px solid var(--ancient-gold);
        }

        .stat-item { display: flex; flex-direction: column; align-items: center; }
        .stat-label { color: #888; font-size: 0.65rem; font-family: 'Uncial Antiqua'; }
        .stat-value { font-size: 1.5rem; color: var(--ancient-gold); font-family: 'Uncial Antiqua'; }

        .btn {
            background: var(--stone);
            color: var(--ancient-gold);
            border: 2px solid var(--ancient-gold);
            padding: 12px 30px;
            font-family: 'Uncial Antiqua';
            cursor: pointer;
            transition: 0.3s;
        }

        .btn:hover { background: var(--ancient-gold); color: var(--stone); box-shadow: 0 0 15px var(--ancient-gold); }
        .btn.secondary { background: #4a3c2e; border-color: #5c4b3a; color: #888; }

        #status {
            min-height: 40px;
            font-size: 1rem;
            font-family: 'Uncial Antiqua';
            color: var(--ancient-gold);
            text-align: center;
        }

        .modal {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95);
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
        }
        .modal.hidden { display: none; }
        .dialog {
            background: var(--stone); padding: 40px; border: 4px solid var(--ancient-gold);
            max-width: 550px; text-align: center; border-radius: 8px;
        }
    </style>
</head>
<body>

<header>
    <h1>üèõÔ∏è ANCIENT BRIDGES</h1>
    <div style="color: var(--ancient-gold); font-size: 0.8rem; font-family: 'Uncial Antiqua';">GRB-008: PRIM'S MST ALGORITHM</div>
</header>

<main>
    <div class="game-area">
        <div style="color: #948a7b;">Reconnect the ancient civilization! Start from one ruin and grow the network efficiently.</div>

        <div class="map-container" id="map">
            <div class="priority-queue" id="pqDisplay">
                <div style="font-family: 'Uncial Antiqua'; font-size: 0.7rem; color: var(--ancient-gold); border-bottom: 1px solid;">NEAREST RUINS</div>
                <!-- PQ Items -->
            </div>
            <!-- Ruins and Bridges -->
        </div>

        <div class="stats-panel">
            <div class="stat-item"><span class="stat-label">TOTAL COST</span><span class="stat-value" id="totalCost">0</span></div>
            <div class="stat-item"><span class="stat-label">REACHED</span><span class="stat-value" id="reachedCount">1</span></div>
            <div class="stat-item"><span class="stat-label">BRIDGES</span><span class="stat-value" id="bridgeCount">0</span></div>
        </div>

        <div id="status">UNCOVERING ANCIENT RUINS...</div>

        <div style="display: flex; gap: 15px;">
            <button class="btn" onclick="game.step()">EXPAND BRIDGE</button>
            <button class="btn" onclick="game.autoRun()">GRAND RESTORATION</button>
            <button class="btn secondary" onclick="game.reset()">FORGET</button>
            <button class="btn secondary" onclick="game.newMap()">NEW SITES</button>
        </div>
    </div>
</main>

<div id="modal" class="modal">
    <div class="dialog">
        <h2 style="color: var(--ancient-gold); font-family: 'Uncial Antiqua';">üèõÔ∏è ANCIENT BRIDGES</h2>
        <div style="text-align:left; line-height:1.7; color:#bbb; font-size:1rem; margin-bottom:20px;">
            <p>Restore connectivity between ancient ruins using <b>Prim's Algorithm</b>.</p>
            <p><b>RESTORATION LOGIC:</b></p>
            <ul style="padding-left: 20px;">
                <li>Start from Ruin 0.</li>
                <li>At each step, look at all ruins connected to your <b>Already Reached</b> network.</li>
                <li>Pick the <b>Cheapest Bridge</b> that connects to an unreached ruin.</li>
                <li>Add it to your network and update your surroundings.</li>
            </ul>
        </div>
        <button class="btn" onclick="game.start()">BEGIN EXCAVATION</button>
    </div>
</div>

<script>
class Game {
    constructor() {
        this.nodes = [];
        this.adj = [];
        this.visited = new Set();
        this.mst = [];
        this.pq = []; // simple array for visual PQ [{w, from, to}]
        this.totalCost = 0;
        this.source = 0;
        this.autoInterval = null;

        this.ui = {
            map: document.getElementById('map'),
            pqDisplay: document.getElementById('pqDisplay'),
            totalCost: document.getElementById('totalCost'),
            reachedCount: document.getElementById('reachedCount'),
            bridgeCount: document.getElementById('bridgeCount'),
            status: document.getElementById('status'),
            modal: document.getElementById('modal')
        };
    }

    start() {
        this.ui.modal.classList.add('hidden');
        this.newMap();
    }

    newMap() {
        const n = Math.floor(Math.random() * 3) + 7;
        this.nodes = [];
        const padding = 60;
        for (let i = 0; i < n; i++) {
            this.nodes.push({
                x: padding + Math.random() * (700 - 2 * padding),
                y: padding + Math.random() * (450 - 2 * padding),
                id: i
            });
        }
        
        this.adj = Array.from({length: n}, () => []);
        this.allEdges = [];
        for (let i = 0; i < n; i++) {
            for (let j = i + 1; j < n; j++) {
                if (Math.random() > 0.6 || (i+1)%n === j) {
                    const w = Math.floor(Math.random() * 12) + 1;
                    this.adj[i].push({to: j, w});
                    this.adj[j].push({to: i, w});
                    this.allEdges.push({u: i, v: j, w});
                }
            }
        }
        this.reset();
    }

    reset() {
        if (this.autoInterval) clearInterval(this.autoInterval);
        this.autoInterval = null;
        this.visited = new Set([this.source]);
        this.mst = [];
        this.totalCost = 0;
        this.pq = [];
        this.addEdgesToPQ(this.source);
        this.ui.status.textContent = 'RUIN 0 RECLAIMED. EXPAND THE NETWORK.';
        this.render();
    }

    addEdgesToPQ(u) {
        this.adj[u].forEach(edge => {
            if (!this.visited.has(edge.to)) {
                this.pq.push({w: edge.w, from: u, to: edge.to});
            }
        });
        this.pq.sort((a, b) => a.w - b.w);
    }

    step() {
        if (this.visited.size === this.nodes.length || this.pq.length === 0) {
            this.ui.status.textContent = 'RESTORE COMPLETE. THE CIVILIZATION IS REUNITED.';
            return false;
        }

        let edge = null;
        while (this.pq.length > 0) {
            const potential = this.pq.shift();
            if (!this.visited.has(potential.to)) {
                edge = potential;
                break;
            }
        }

        if (!edge) return false;

        this.visited.add(edge.to);
        this.mst.push(edge);
        this.totalCost += edge.w;
        this.addEdgesToPQ(edge.to);
        this.ui.status.textContent = `BRIDGE TO RUIN ${edge.to} BUILT (COST: ${edge.w})`;
        this.render();
        return this.visited.size < this.nodes.length;
    }

    autoRun() {
        if (this.autoInterval) return;
        this.autoInterval = setInterval(() => {
            if (!this.step()) {
                clearInterval(this.autoInterval);
                this.autoInterval = null;
            }
        }, 800);
    }

    render() {
        this.ui.map.innerHTML = '<div class="priority-queue" id="pqDisplay"><div style="font-family: \'Uncial Antiqua\'; font-size: 0.7rem; color: var(--ancient-gold); border-bottom: 1px solid;">NEAREST RUINS</div></div>';
        this.ui.pqDisplay = document.getElementById('pqDisplay');

        // Draw All Edges (faded)
        this.allEdges.forEach(e => {
            const u = this.nodes[e.u], v = this.nodes[e.v];
            const line = document.createElement('div');
            line.className = 'bridge-path';
            const dx = v.x - u.x, dy = v.y - u.y;
            line.style.width = Math.sqrt(dx*dx + dy*dy) + 'px';
            line.style.left = u.x + 'px'; line.style.top = u.y + 'px';
            line.style.transform = `rotate(${Math.atan2(dy, dx)}rad)`;
            this.ui.map.appendChild(line);
        });

        // Draw MST Edges (Stable)
        this.mst.forEach(e => {
            const u = this.nodes[e.from], v = this.nodes[e.to];
            const line = document.createElement('div');
            line.className = 'bridge-path built';
            const dx = v.x - u.x, dy = v.y - u.y;
            line.style.width = Math.sqrt(dx*dx + dy*dy) + 'px';
            line.style.left = u.x + 'px'; line.style.top = u.y + 'px';
            line.style.transform = `rotate(${Math.atan2(dy, dx)}rad)`;
            this.ui.map.appendChild(line);

            const cost = document.createElement('div');
            cost.className = 'cost-marker';
            cost.textContent = e.w;
            cost.style.left = (u.x + v.x) / 2 + 'px';
            cost.style.top = (u.y + v.y) / 2 + 'px';
            this.ui.map.appendChild(cost);
        });

        // Draw Ruins
        this.nodes.forEach(n => {
            const ruin = document.createElement('div');
            ruin.className = 'ruin';
            if (this.visited.has(n.id)) ruin.classList.add('in-tree');
            if (this.pq.length > 0 && this.pq[0].to === n.id) ruin.classList.add('exploring');
            
            ruin.style.left = (n.x - 25) + 'px';
            ruin.style.top = (n.y - 25) + 'px';
            ruin.textContent = n.id;
            this.ui.map.appendChild(ruin);
        });

        // Update PQ Display
        this.pq.slice(0, 6).forEach(item => {
            const div = document.createElement('div');
            div.className = 'pq-item';
            div.innerHTML = `<span>To ${item.to}</span> <span>${item.w}œÑ</span>`;
            this.ui.pqDisplay.appendChild(div);
        });

        this.ui.totalCost.textContent = this.totalCost;
        this.ui.reachedCount.textContent = this.visited.size;
        this.ui.bridgeCount.textContent = this.mst.length;
    }
}
const game = new Game();
</script>
</body>
</html>
