<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRB-007: Molecule Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --atom-c: #ff4b2b;
            --atom-o: #3498db;
            --atom-h: #ecf0f1;
            --bond: rgba(255,255,255,0.2);
            --mst-bond: #f1c40f; /* Gold for stable bonds */
            --text: #e2e8f0;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            user-select: none;
            overflow: hidden;
        }

        header {
            background: rgba(15,23,42,0.9);
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--mst-bond);
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.2);
        }

        h1 { 
            margin: 0; 
            font-family: 'Varela Round', sans-serif; 
            color: var(--mst-bond); 
            font-size: 1.6rem;
            text-transform: uppercase;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            gap: 20px;
        }

        .lab-container {
            position: relative;
            width: 700px;
            height: 450px;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            border-radius: 20px;
            border: 2px solid #334155;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }

        .atom {
            position: absolute;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
            border: 2px solid rgba(255,255,255,0.5);
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .atom.carbon { background: var(--atom-c); }
        .atom.oxygen { background: var(--atom-o); }
        .atom.hydrogen { background: var(--atom-h); color: #000; }
        .atom.searching { transform: scale(1.2); box-shadow: 0 0 25px var(--mst-bond); }

        .bond-line {
            position: absolute;
            height: 3px;
            background: var(--bond);
            transform-origin: left center;
            pointer-events: none;
            z-index: 5;
        }
        .bond-line.stable { background: var(--mst-bond); height: 5px; box-shadow: 0 0 10px var(--mst-bond); z-index: 6; }
        .bond-line.checking { background: #fff; height: 5px; animation: flicker 0.2s infinite; }

        @keyframes flicker { 0% { opacity: 0.5; } 100% { opacity: 1; } }

        .energy-badge {
            position: absolute;
            background: #000;
            color: #fff;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            transform: translate(-50%, -50%);
            z-index: 11;
            border: 1px solid var(--bond);
        }

        .sorted-edges {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #1e293b;
            border-radius: 10px;
            width: 90%;
            overflow-x: auto;
            border: 1px dashed var(--mst-bond);
        }

        .edge-chip {
            padding: 5px 12px;
            background: #0f172a;
            border: 1px solid var(--bond);
            border-radius: 15px;
            font-size: 0.8rem;
            white-space: nowrap;
            color: #94a3b8;
        }
        .edge-chip.current { border-color: #fff; color: #fff; transform: scale(1.1); }
        .edge-chip.accepted { border-color: var(--mst-bond); color: var(--mst-bond); }
        .edge-chip.rejected { text-decoration: line-through; opacity: 0.5; }

        .stats-panel {
            display: flex;
            gap: 25px;
            padding: 15px 30px;
            background: #1e293b;
            border-radius: 12px;
        }

        .stat-item { display: flex; flex-direction: column; align-items: center; }
        .stat-label { color: #64748b; font-size: 0.7rem; text-transform: uppercase; }
        .stat-value { font-size: 1.5rem; color: var(--mst-bond); font-weight: bold; }

        .btn {
            background: transparent;
            color: var(--mst-bond);
            border: 2px solid var(--mst-bond);
            padding: 10px 25px;
            font-family: 'Share Tech Mono';
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.3s;
        }

        .btn:hover { background: var(--mst-bond); color: #000; box-shadow: 0 0 15px var(--mst-bond); }
        .btn.secondary { border-color: #475569; color: #94a3b8; }

        #status {
            min-height: 40px;
            font-size: 1.1rem;
            color: var(--mst-bond);
            text-align: center;
        }

        .modal {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95);
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
        }
        .modal.hidden { display: none; }
        .dialog {
            background: #1e293b; padding: 40px; border: 2px solid var(--mst-bond);
            max-width: 550px; text-align: center; border-radius: 15px;
        }
    </style>
</head>
<body>

<header>
    <h1>ðŸ§¬ MOLECULE BUILDER</h1>
    <div style="color: #64748b; font-size: 0.8rem;">GRB-007: KRUSKAL'S MST ALGORITHM</div>
</header>

<main>
    <div class="game-area">
        <div style="color: #94a3b8;">Stabilize the molecule! Connect all atoms using the <b>Minimum Total Energy</b>.</div>

        <div class="lab-container" id="lab">
            <!-- Atoms and energy bonds -->
        </div>

        <div style="color: var(--mst-bond); font-size: 0.9rem;">SORTED POTENTIAL BONDS (Kruskal's Input)</div>
        <div class="sorted-edges" id="edgeList">
            <!-- Edge chips -->
        </div>

        <div class="stats-panel">
            <div class="stat-item"><span class="stat-label">TOTAL ENERGY</span><span class="stat-value" id="totalEnergy">0</span></div>
            <div class="stat-item"><span class="stat-label">COMPONENTS</span><span class="stat-value" id="compCount">N</span></div>
            <div class="stat-item"><span class="stat-label">STABLE BONDS</span><span class="stat-value" id="bondCount">0</span></div>
        </div>

        <div id="status">INITIATE MOLECULAR ASSEMBLY...</div>

        <div style="display: flex; gap: 15px;">
            <button class="btn" onclick="game.step()">BOND NEXT PAIR</button>
            <button class="btn" onclick="game.autoRun()">AUTO STABILIZE</button>
            <button class="btn secondary" onclick="game.reset()">DISSOLVE</button>
            <button class="btn secondary" onclick="game.newMolecule()">NEW ATOMS</button>
        </div>
    </div>
</main>

<div id="modal" class="modal">
    <div class="dialog">
        <h2 style="color: var(--mst-bond); font-family: 'Varela Round';">ðŸ§¬ MOLECULE BUILDER</h2>
        <div style="text-align:left; line-height:1.6; color:#94a3b8; font-size:1rem; margin-bottom:20px;">
            <p>Assemble the most stable molecule structure using <b>Kruskal's Algorithm</b>.</p>
            <p><b>STABILIZATION LOGIC:</b></p>
            <ul style="padding-left: 20px;">
                <li>Potential bonds are sorted by <b>Energy Cost</b> (lowest first).</li>
                <li>At each step, we try to create the lowest energy bond.</li>
                <li>The bond is only <b>Stabilized</b> if it connects two previously separate atom clusters (using <b>DSU</b>).</li>
                <li>Cycles would waste energy and are rejected!</li>
            </ul>
        </div>
        <button class="btn" onclick="game.start()">ENGAGE LAB</button>
    </div>
</div>

<script>
class DSU {
    constructor(n) {
        this.parent = Array.from({length: n}, (_, i) => i);
        this.count = n;
    }
    find(i) {
        if (this.parent[i] === i) return i;
        return this.parent[i] = this.find(this.parent[i]);
    }
    union(i, j) {
        let rootI = this.find(i);
        let rootJ = this.find(j);
        if (rootI !== rootJ) {
            this.parent[rootI] = rootJ;
            this.count--;
            return true;
        }
        return false;
    }
}

class Game {
    constructor() {
        this.nodes = [];
        this.edges = []; // {u, v, w, id}
        this.mst = [];
        this.edgeIdx = 0;
        this.totalEnergy = 0;
        this.dsu = null;
        this.autoInterval = null;

        this.ui = {
            lab: document.getElementById('lab'),
            edgeList: document.getElementById('edgeList'),
            totalEnergy: document.getElementById('totalEnergy'),
            compCount: document.getElementById('compCount'),
            bondCount: document.getElementById('bondCount'),
            status: document.getElementById('status'),
            modal: document.getElementById('modal')
        };
    }

    start() {
        this.ui.modal.classList.add('hidden');
        this.newMolecule();
    }

    newMolecule() {
        const n = Math.floor(Math.random() * 3) + 7;
        this.nodes = [];
        const padding = 60;
        const types = ['carbon', 'oxygen', 'hydrogen'];
        for (let i = 0; i < n; i++) {
            this.nodes.push({
                x: padding + Math.random() * (700 - 2 * padding),
                y: padding + Math.random() * (450 - 2 * padding),
                type: types[i % types.length]
            });
        }
        
        this.edges = [];
        for (let i = 0; i < n; i++) {
            for (let j = i + 1; j < n; j++) {
                if (Math.random() > 0.6 || (i+1)%n === j) {
                    this.edges.push({u: i, v: j, w: Math.floor(Math.random() * 15) + 5, status: 'pending'});
                }
            }
        }
        this.edges.sort((a, b) => a.w - b.w);
        this.reset();
    }

    reset() {
        if (this.autoInterval) clearInterval(this.autoInterval);
        this.autoInterval = null;
        this.dsu = new DSU(this.nodes.length);
        this.edgeIdx = 0;
        this.mst = [];
        this.totalEnergy = 0;
        this.edges.forEach(e => e.status = 'pending');
        this.ui.status.textContent = 'READY FOR BONDING. SELECT LOWEST ENERGY.';
        this.render();
    }

    step() {
        if (this.edgeIdx >= this.edges.length || this.dsu.count === 1) {
            this.ui.status.textContent = 'MOLECULE STABILIZED. MST COMPLETE.';
            return false;
        }

        const e = this.edges[this.edgeIdx];
        if (this.dsu.union(e.u, e.v)) {
            e.status = 'accepted';
            this.mst.push(e);
            this.totalEnergy += e.w;
            this.ui.status.textContent = `BOND [${e.u}-${e.v}] STABILIZED. ENERGY +${e.w}.`;
        } else {
            e.status = 'rejected';
            this.ui.status.textContent = `BOND [${e.u}-${e.v}] REJECTED. CLUSTER ALREADY CONNECTED.`;
        }

        this.edgeIdx++;
        this.render();
        return this.dsu.count > 1;
    }

    autoRun() {
        if (this.autoInterval) return;
        this.autoInterval = setInterval(() => {
            if (!this.step()) {
                clearInterval(this.autoInterval);
                this.autoInterval = null;
            }
        }, 600);
    }

    render() {
        this.ui.lab.innerHTML = '';
        this.ui.edgeList.innerHTML = '';

        // Potential Bonds
        this.edges.forEach((e, i) => {
            const u = this.nodes[e.u], v = this.nodes[e.v];
            const line = document.createElement('div');
            line.className = 'bond-line';
            if (e.status === 'accepted') line.classList.add('stable');
            if (i === this.edgeIdx) line.classList.add('checking');
            
            const dx = v.x - u.x, dy = v.y - u.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const angle = Math.atan2(dy, dx);
            
            line.style.width = dist + 'px';
            line.style.left = u.x + 'px';
            line.style.top = u.y + 'px';
            line.style.transform = `rotate(${angle}rad)`;
            this.ui.lab.appendChild(line);

            if (e.status !== 'pending' || i === this.edgeIdx) {
                const badge = document.createElement('div');
                badge.className = 'energy-badge';
                badge.textContent = e.w;
                badge.style.left = (u.x + v.x) / 2 + 'px';
                badge.style.top = (u.y + v.y) / 2 + 'px';
                this.ui.lab.appendChild(badge);
            }

            // Edge chip in list
            const chip = document.createElement('div');
            chip.className = `edge-chip ${e.status}`;
            if (i === this.edgeIdx) chip.classList.add('current');
            chip.textContent = `${e.u}-${e.v} (${e.w})`;
            this.ui.edgeList.appendChild(chip);
        });

        // Atoms
        this.nodes.forEach((n, i) => {
            const atom = document.createElement('div');
            atom.className = `atom ${n.type}`;
            if (this.edges[this.edgeIdx] && (this.edges[this.edgeIdx].u === i || this.edges[this.edgeIdx].v === i)) {
                atom.classList.add('searching');
            }
            atom.style.left = (n.x - 22) + 'px';
            atom.style.top = (n.y - 22) + 'px';
            atom.textContent = n.type[0].toUpperCase();
            this.ui.lab.appendChild(atom);
        });

        this.ui.totalEnergy.textContent = this.totalEnergy;
        this.ui.compCount.textContent = this.dsu.count;
        this.ui.bondCount.textContent = this.mst.length;
    }
}
const game = new Game();
</script>
</body>
</html>
