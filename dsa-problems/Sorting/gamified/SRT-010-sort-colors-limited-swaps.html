<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT-010: Dutch National Flag</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-grad-start: #0f172a;
            --bg-grad-end: #1e293b;
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.5);
            --accent: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(148, 163, 184, 0.1);
            --red: #ef4444;
            --white: #f8fafc;
            --blue: #3b82f6;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at top left, var(--bg-grad-start), var(--bg-grad-end));
            color: var(--text-main);
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--card-border);
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
        }

        .brand { display: flex; align-items: center; gap: 12px; }
        .brand-icon {
            background: linear-gradient(135deg, var(--red), var(--white), var(--blue));
            width: 40px; height: 40px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 1.2rem; color: #000;
            box-shadow: 0 0 15px var(--primary-glow);
        }
        h1 { margin: 0; font-size: 1.2rem; font-weight: 600; }

        .stats {
            display: flex; gap: 20px;
            font-family: 'JetBrains Mono', monospace;
            background: rgba(255,255,255,0.05);
            padding: 8px 16px; border-radius: 8px;
            border: 1px solid var(--card-border);
        }
        .stat-item span { color: var(--accent); font-weight: bold; }

        main { display: flex; flex: 1; height: calc(100vh - 80px); }

        aside {
            width: 380px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--card-border);
            padding: 2rem;
            display: flex; flex-direction: column; gap: 1.5rem;
            overflow-y: auto;
        }

        .panel { display: flex; flex-direction: column; gap: 1rem; }
        .panel-header {
            font-size: 0.85rem; text-transform: uppercase;
            letter-spacing: 1.5px; color: var(--text-muted);
            font-weight: 700;
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 0.5rem;
        }

        .mission-card {
            background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(59,130,246,0.1));
            border: 1px solid rgba(236,72,153,0.3);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        .mission-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem; font-weight: 700;
            color: #fbcfe8;
        }

        .hint-text {
            font-size: 0.9rem; line-height: 1.6;
            color: var(--text-muted);
            background: rgba(0,0,0,0.2);
            padding: 1rem; border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .pointer-info {
            display: flex; gap: 10px; flex-wrap: wrap;
        }
        .ptr-badge {
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .ptr-badge.low { background: rgba(239,68,68,0.2); border: 1px solid var(--red); color: var(--red); }
        .ptr-badge.mid { background: rgba(248,250,252,0.1); border: 1px solid var(--white); color: var(--white); }
        .ptr-badge.high { background: rgba(59,130,246,0.2); border: 1px solid var(--blue); color: var(--blue); }

        .btn-group { display: flex; flex-direction: column; gap: 10px; }

        button.code-btn {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--card-border);
            color: var(--text-muted);
            padding: 1rem; border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem; text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        button.code-btn:before {
            content: '';
            position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
            background: var(--primary); opacity: 0;
            transition: opacity 0.2s;
        }
        button.code-btn:hover:not(:disabled) {
            background: rgba(99, 102, 241, 0.1);
            color: white;
            transform: translateX(5px);
            border-color: var(--primary);
        }
        button.code-btn:hover:not(:disabled):before { opacity: 1; }
        button.code-btn.active-glow {
            border-color: var(--accent);
            color: white;
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.2);
            animation: pulse-border 2s infinite;
        }
        @keyframes pulse-border {
            0% { border-color: var(--accent); }
            50% { border-color: var(--primary); }
            100% { border-color: var(--accent); }
        }
        button.code-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        #game-area {
            flex: 1;
            position: relative;
            background-image:
                radial-gradient(rgba(148, 163, 184, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .array-container {
            display: flex; gap: 10px;
            padding: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            border: 1px solid var(--card-border);
            position: relative;
        }

        .element {
            width: 60px; height: 60px;
            border-radius: 50%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            font-weight: 700; font-size: 1.4rem;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            cursor: pointer;
            border: 3px solid transparent;
        }
        .element[data-val="0"] { background: var(--red); color: white; }
        .element[data-val="1"] { background: var(--white); color: #000; }
        .element[data-val="2"] { background: var(--blue); color: white; }

        .element.ptr-low { border-color: var(--red); box-shadow: 0 0 15px var(--red); }
        .element.ptr-mid { border-color: var(--white); box-shadow: 0 0 15px var(--white); }
        .element.ptr-high { border-color: var(--blue); box-shadow: 0 0 15px var(--blue); }

        .element.swapping { animation: swap-bounce 0.5s ease-in-out; }
        @keyframes swap-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25px); }
        }

        .ptr-label {
            position: absolute;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 4px;
        }
        .ptr-label.low { background: var(--red); color: white; top: -25px; }
        .ptr-label.mid { background: var(--white); color: #000; bottom: -25px; }
        .ptr-label.high { background: var(--blue); color: white; top: -25px; }

        .console {
            position: absolute;
            bottom: 2rem; right: 2rem;
            width: 350px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            max-height: 180px;
            overflow-y: auto;
        }
        .console-header {
            color: var(--text-muted);
            border-bottom: 1px solid #334155;
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex; justify-content: space-between;
        }
        .log-entry {
            margin-bottom: 4px;
            color: #a5f3fc;
            opacity: 0;
            animation: slideIn 0.3s forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .backdrop {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.4s;
        }
        .backdrop.active { opacity: 1; pointer-events: all; }

        .modal {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 1px solid var(--card-border);
            padding: 3rem; border-radius: 24px;
            max-width: 550px; text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .backdrop.active .modal { transform: scale(1); }
        .modal h2 {
            font-size: 2rem; margin-bottom: 1rem;
            background: linear-gradient(to right, var(--red), var(--white), var(--blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--red), var(--blue));
            border: none; color: white;
            padding: 1rem 2.5rem;
            font-size: 1.1rem; font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transition: all 0.3s;
            margin-top: 1.5rem;
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6);
        }

        .toast {
            position: fixed; top: 20px; left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 200;
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        .color-legend {
            display: flex; gap: 15px; justify-content: center; margin: 1rem 0;
        }
        .legend-item {
            display: flex; align-items: center; gap: 8px;
            font-size: 0.9rem;
        }
        .legend-circle {
            width: 24px; height: 24px; border-radius: 50%;
        }

    </style>
</head>
<body>

<header>
    <div class="brand">
        <div class="brand-icon">F</div>
        <h1>SRT-010 <span style="font-weight:300; opacity:0.7">Dutch National Flag</span></h1>
    </div>
    <div class="stats">
        <div class="stat-item">XP: <span id="score">0</span></div>
        <div class="stat-item" style="border-left:1px solid #334155; margin-left:10px; padding-left:10px;">SWAPS: <span id="swaps">0</span></div>
    </div>
</header>

<main>
    <aside>
        <div class="panel">
            <div class="panel-header">Objective</div>
            <div class="mission-card">
                <div class="mission-text">SORT: 0s | 1s | 2s</div>
                <div style="font-size:0.8rem; color:#94a3b8; margin-top:8px;">All 0s left, all 2s right, 1s in middle</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">Pointers</div>
            <div class="pointer-info">
                <div class="ptr-badge low">LOW: <span id="ptr-low">0</span></div>
                <div class="ptr-badge mid">MID: <span id="ptr-mid">0</span></div>
                <div class="ptr-badge high">HIGH: <span id="ptr-high">0</span></div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">Algorithm Steps</div>
            <div class="btn-group">
                <button id="btn-check" class="code-btn active-glow" onclick="game.checkCurrent()">
                    <span style="color:var(--accent)">1.</span> Check arr[mid]
                </button>
                <button id="btn-swap-low" class="code-btn" onclick="game.swapLow()" disabled>
                    <span style="color:var(--red)">2a.</span> If 0: swap(low, mid), low++, mid++
                </button>
                <button id="btn-skip" class="code-btn" onclick="game.skipMid()" disabled>
                    <span style="color:#ccc">2b.</span> If 1: mid++ (no swap needed)
                </button>
                <button id="btn-swap-high" class="code-btn" onclick="game.swapHigh()" disabled>
                    <span style="color:var(--blue)">2c.</span> If 2: swap(mid, high), high--
                </button>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">AI Assistant</div>
            <div id="hint-box" class="hint-text">
                The Dutch National Flag algorithm uses 3 pointers: LOW, MID, HIGH. Click "Check" to see the current element at MID.
            </div>
        </div>
    </aside>

    <div id="game-area">
        <div class="array-container" id="array-container">
            <!-- Elements rendered here -->
        </div>

        <div class="console">
            <div class="console-header">
                <span>SYSTEM LOG</span>
                <span style="color: var(--success);">● LIVE</span>
            </div>
            <div id="log-content"></div>
        </div>
    </div>
</main>

<div id="start-modal" class="backdrop active">
    <div class="modal">
        <h2>Dutch National Flag</h2>
        <p style="color:#cbd5e1; line-height:1.6; margin-bottom:1rem;">
            Sort an array containing only 0s, 1s, and 2s in linear time using the 3-pointer technique!
        </p>
        <div class="color-legend">
            <div class="legend-item"><div class="legend-circle" style="background:var(--red)"></div> 0 (Red)</div>
            <div class="legend-item"><div class="legend-circle" style="background:var(--white)"></div> 1 (White)</div>
            <div class="legend-item"><div class="legend-circle" style="background:var(--blue)"></div> 2 (Blue)</div>
        </div>
        <div style="text-align:left; color:#94a3b8; font-size:0.85rem; margin:1rem 0; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px;">
            <b>Three Pointers:</b>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li><b>LOW</b>: Boundary for 0s (everything before is 0)</li>
                <li><b>MID</b>: Current element being processed</li>
                <li><b>HIGH</b>: Boundary for 2s (everything after is 2)</li>
            </ul>
        </div>
        <button class="btn-primary" onclick="game.start()">START SORTING</button>
    </div>
</div>

<div id="victory-modal" class="backdrop">
    <div class="modal">
        <h2>Flag Sorted!</h2>
        <p style="color:#cbd5e1;">You've successfully sorted the Dutch National Flag!</p>
        <p style="font-size:1.5rem; font-weight:bold; color:var(--primary); margin:1rem 0;">
            Score: <span id="final-score">0</span> | Swaps: <span id="final-swaps">0</span>
        </p>
        <button class="btn-primary" onclick="this.loadLevel()">TRY AGAIN</button>
    </div>
</div>

<div id="toast" class="toast">Message</div>

<script>
    class Game {
        constructor() {
            this.array = [];
            this.n = 10;
            this.low = 0;
            this.mid = 0;
            this.high = 0;
            this.score = 0;
            this.swaps = 0;
            this.state = 'IDLE';

            this.ui = {
                container: document.getElementById('array-container'),
                log: document.getElementById('log-content'),
                score: document.getElementById('score'),
                swapCount: document.getElementById('swaps'),
                ptrLow: document.getElementById('ptr-low'),
                ptrMid: document.getElementById('ptr-mid'),
                ptrHigh: document.getElementById('ptr-high'),
                hint: document.getElementById('hint-box')
            };
        }

        start() {
            document.getElementById('start-modal').classList.remove('active');
            this.generateArray();
            this.low = 0;
            this.mid = 0;
            this.high = this.n - 1;
            this.log('Array initialized. Begin sorting!');
            this.updateButtons('CHECK');
            this.render();
        }

        generateArray() {
            this.array = [];
            for (let i = 0; i < this.n; i++) {
                this.array.push(Math.floor(Math.random() * 3));
            }
        }

        render() {
            this.ui.container.innerHTML = '';
            this.array.forEach((val, idx) => {
                const el = document.createElement('div');
                el.className = 'element';
                el.setAttribute('data-val', val);
                el.textContent = val;

                // Show pointer labels
                if (idx === this.low && idx === this.mid && idx === this.high) {
                    el.innerHTML = `${val}<span class="ptr-label low">L</span><span class="ptr-label mid" style="bottom:-40px">M</span><span class="ptr-label high" style="top:-40px">H</span>`;
                    el.classList.add('ptr-low');
                } else if (idx === this.low && idx === this.mid) {
                    el.innerHTML = `${val}<span class="ptr-label low">L</span><span class="ptr-label mid">M</span>`;
                    el.classList.add('ptr-mid');
                } else if (idx === this.mid && idx === this.high) {
                    el.innerHTML = `${val}<span class="ptr-label mid">M</span><span class="ptr-label high">H</span>`;
                    el.classList.add('ptr-mid');
                } else if (idx === this.low) {
                    el.innerHTML = `${val}<span class="ptr-label low">L</span>`;
                    el.classList.add('ptr-low');
                } else if (idx === this.mid) {
                    el.innerHTML = `${val}<span class="ptr-label mid">M</span>`;
                    el.classList.add('ptr-mid');
                } else if (idx === this.high) {
                    el.innerHTML = `${val}<span class="ptr-label high">H</span>`;
                    el.classList.add('ptr-high');
                }

                this.ui.container.appendChild(el);
            });

            this.ui.score.textContent = this.score;
            this.ui.swapCount.textContent = this.swaps;
            this.ui.ptrLow.textContent = this.low;
            this.ui.ptrMid.textContent = this.mid;
            this.ui.ptrHigh.textContent = this.high;
        }

        checkCurrent() {
            if (this.mid > this.high) {
                this.victory();
                return;
            }

            const val = this.array[this.mid];
            this.log(`Checking arr[${this.mid}] = ${val}`);
            this.state = 'CHECKED';

            if (val === 0) {
                this.ui.hint.textContent = `Found 0 (Red)! Swap with LOW position and move both LOW and MID forward.`;
                this.updateButtons('SWAP_LOW');
            } else if (val === 1) {
                this.ui.hint.textContent = `Found 1 (White)! Already in correct zone. Just move MID forward.`;
                this.updateButtons('SKIP');
            } else {
                this.ui.hint.textContent = `Found 2 (Blue)! Swap with HIGH position and move HIGH backward.`;
                this.updateButtons('SWAP_HIGH');
            }
        }

        async swapLow() {
            const elements = this.ui.container.children;
            elements[this.low].classList.add('swapping');
            elements[this.mid].classList.add('swapping');

            await this.sleep(400);

            [this.array[this.low], this.array[this.mid]] = [this.array[this.mid], this.array[this.low]];
            this.swaps++;
            this.score += 15;
            this.log(`Swapped arr[${this.low}] ↔ arr[${this.mid}]`);

            this.low++;
            this.mid++;
            this.log(`low++ → ${this.low}, mid++ → ${this.mid}`);

            this.showToast('+15 XP - Swap Complete!');
            this.checkComplete();
        }

        async skipMid() {
            this.mid++;
            this.score += 10;
            this.log(`mid++ → ${this.mid} (1 already in place)`);
            this.showToast('+10 XP - Skipped!');
            this.checkComplete();
        }

        async swapHigh() {
            const elements = this.ui.container.children;
            elements[this.mid].classList.add('swapping');
            elements[this.high].classList.add('swapping');

            await this.sleep(400);

            [this.array[this.mid], this.array[this.high]] = [this.array[this.high], this.array[this.mid]];
            this.swaps++;
            this.score += 15;
            this.log(`Swapped arr[${this.mid}] ↔ arr[${this.high}]`);

            this.high--;
            this.log(`high-- → ${this.high}`);

            this.showToast('+15 XP - Swap Complete!');
            this.checkComplete();
        }

        checkComplete() {
            if (this.mid > this.high) {
                this.victory();
            } else {
                this.updateButtons('CHECK');
                this.render();
            }
        }

        victory() {
            this.log('Sorting complete! All elements in place.');
            document.getElementById('final-score').textContent = this.score;
            document.getElementById('final-swaps').textContent = this.swaps;
            document.getElementById('victory-modal').classList.add('active');
        }

        updateButtons(state) {
            const btns = {
                check: document.getElementById('btn-check'),
                swapLow: document.getElementById('btn-swap-low'),
                skip: document.getElementById('btn-skip'),
                swapHigh: document.getElementById('btn-swap-high')
            };

            Object.values(btns).forEach(b => {
                b.disabled = true;
                b.classList.remove('active-glow');
            });

            if (state === 'CHECK') {
                btns.check.disabled = false;
                btns.check.classList.add('active-glow');
            } else if (state === 'SWAP_LOW') {
                btns.swapLow.disabled = false;
                btns.swapLow.classList.add('active-glow');
            } else if (state === 'SKIP') {
                btns.skip.disabled = false;
                btns.skip.classList.add('active-glow');
            } else if (state === 'SWAP_HIGH') {
                btns.swapHigh.disabled = false;
                btns.swapHigh.classList.add('active-glow');
            }
        }

        log(msg) {
            const d = document.createElement('div');
            d.className = 'log-entry';
            d.textContent = `> ${msg}`;
            this.ui.log.appendChild(d);
            this.ui.log.scrollTop = this.ui.log.scrollHeight;
        }

        showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast show';
            setTimeout(() => t.className = 'toast', 2500);
        }

        sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    }

    const game = new Game();
</script>
</body>
</html>
