<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STC-001: Pattern Radar</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #002b36; --text: #839496; --green: #859900; --cyan: #2aa198; --red: #dc322f; }
        * { box-sizing: border-box; }
        body { font-family: 'VT323', monospace; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        header { font-size: 2.5rem; color: var(--cyan); margin-bottom: 10px; text-shadow: 0 0 5px var(--cyan); }
        .desc { max-width: 600px; text-align: center; font-size: 1.2rem; margin-bottom: 30px; }

        .radar-screen {
            position: relative; width: 800px; height: 300px; background: #073642; border: 4px solid var(--text);
            border-radius: 10px; overflow: hidden; display: flex; align-items: center; justify-content: center;
        }

        .signal-row {
            display: flex; gap: 5px;
        }

        .char-box {
            width: 50px; height: 80px; display: flex; flex-direction: column; align-items: center; 
            border: 1px solid #586e75; background: #002b36; position: relative;
        }
        .char-val { font-size: 2rem; color: #fff; height: 50px; display: flex; align-items: center; justify-content: center; width: 100%; border-bottom: 1px dashed #586e75; }
        .pi-val { font-size: 1.5rem; color: var(--green); height: 30px; display: flex; align-items: center; justify-content: center; width: 100%; cursor: pointer; }
        .pi-val:hover { background: #073642; }
        
        .char-box.active { border-color: var(--cyan); box-shadow: 0 0 10px var(--cyan); }
        .char-box.matched { background: rgba(133, 153, 0, 0.2); }

        .controls { margin-top: 20px; display: flex; gap: 20px; align-items: center; }
        input { font-family: 'VT323'; font-size: 1.5rem; background: #073642; color: #fff; border: 1px solid var(--text); padding: 5px 10px; width: 200px; text-transform: uppercase; letter-spacing: 5px; text-align: center; }
        button { font-family: 'VT323'; font-size: 1.5rem; background: var(--cyan); color: #002b36; border: none; padding: 10px 20px; cursor: pointer; }
        button:hover { background: #93a1a1; }

        #msg { height: 30px; color: var(--red); font-size: 1.5rem; margin-top: 10px; }
        
        .scan-line {
            position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: var(--green); opacity: 0.5; pointer-events: none;
        }
        
        .prefix-overlay {
            position: absolute; height: 4px; background: var(--green); bottom: 85px; pointer-events: none; transition: all 0.2s;
        }
        .suffix-overlay {
            position: absolute; height: 4px; background: var(--cyan); bottom: 95px; pointer-events: none; transition: all 0.2s;
        }

    </style>
</head>
<body>
<header>STC-001: PATTERN RADAR</header>
<div class="desc">
    Interactive KMP Prefix Function (Ï€-table).<br>
    Goal: Identify the longest proper prefix that is also a suffix for each position.
</div>

<div class="radar-screen">
    <div class="signal-row" id="row"></div>
    <div class="prefix-overlay" id="preLine"></div>
    <div class="suffix-overlay" id="sufLine"></div>
</div>

<div id="msg"></div>

<div class="controls">
    <input type="text" id="pattern" value="ABACABA" maxlength="12">
    <button onclick="game.load()">LOAD SIGNAL</button>
    <button onclick="game.auto()">AUTO-SCAN</button>
</div>
<div style="margin-top:10px; font-size: 1.2rem; color: #aaa;">Click the green '? ' to verify Pi-value manually!</div>

<script>
class Game {
    constructor() {
        this.s = "";
        this.pi = [];
        this.ui = { row: document.getElementById('row'), msg: document.getElementById('msg'), pre: document.getElementById('preLine'), suf: document.getElementById('sufLine') };
        this.load();
    }

    load() {
        this.s = document.getElementById('pattern').value.toUpperCase();
        if(!this.s) return;
        
        this.pi = Array(this.s.length).fill(0);
        this.calcPi(); // Pre-calc for validation
        
        this.ui.row.innerHTML = '';
        this.ui.pre.style.width = '0';
        this.ui.suf.style.width = '0';
        
        for(let i=0; i<this.s.length; i++) {
            let box = document.createElement('div');
            box.className = 'char-box';
            box.innerHTML = `
                <div class="char-val">${this.s[i]}</div>
                <div class="pi-val" id="pi-${i}" onclick="game.check(${i})">?</div>
            `;
            this.ui.row.appendChild(box);
        }
    }

    calcPi() {
        let n = this.s.length;
        let pi = Array(n).fill(0);
        for(let i=1; i<n; i++) {
            let j = pi[i-1];
            while(j > 0 && this.s[i] !== this.s[j]) j = pi[j-1];
            if(this.s[i] === this.s[j]) j++;
            pi[i] = j;
        }
        this.pi = pi;
    }

    check(i) {
        // User interaction: Click to reveal/calculate
        // Visualize the comparison
        let correct = this.pi[i];
        
        // Show prefix vs suffix
        // Suffix ends at i, length 'correct'
        // Prefix ends at correct-1, length 'correct'
        
        let el = document.getElementById(`pi-${i}`);
        el.innerText = correct;
        el.style.color = "#fff";
        el.parentElement.classList.add('active');
        
        this.visualize(i, correct);
    }
    
    async visualize(idx, len) {
        if (len === 0) {
            this.msg("No prefix match.");
            this.ui.pre.style.width = '0';
            this.ui.suf.style.width = '0';
            return;
        }
        
        this.msg(`Match! Length ${len}: Prefix vs Suffix ending at ${idx}`);
        
        // Get positions
        let boxes = document.querySelectorAll('.char-box');
        let firstBox = boxes[0].getBoundingClientRect();
        let parent = this.ui.row.getBoundingClientRect();
        
        let boxW = 55; // 50+5 gap
        
        // Prefix visual (indices 0 to len-1)
        this.ui.pre.style.left = (0) + 'px'; // Relative to row actually
        // Since overlay is abs in container... adjust logic
        // Let's use simplified pixel math relative to container center
        // Center of container vs row start...
        // Easier: Append overlay INSIDE row? No row is flex.
        // Let's assume centered row.
        
        // Re-implement overlays as children of boxes? No, simpler:
        // Highlight logic
        boxes.forEach(b => b.classList.remove('matched'));
        
        for(let k=0; k<len; k++) {
            boxes[k].classList.add('matched'); // Prefix
            boxes[idx - len + 1 + k].classList.add('matched'); // Suffix
        }
    }

    async auto() {
        for(let i=0; i<this.s.length; i++) {
            this.check(i);
            await new Promise(r => setTimeout(r, 500));
        }
    }

    msg(t) { this.ui.msg.innerText = t; }
}
const game = new Game();
</script>
</body>
</html>
