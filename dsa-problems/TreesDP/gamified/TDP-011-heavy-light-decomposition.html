<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDP-011: Highway System</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Chakra Petch', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }

        .hld-ui {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 { color: #00ccff; font-size: 26px; text-shadow: 0 0 20px #00ccff; }

        .desc { color: #666; font-size: 11px; margin: 10px 0 20px; }

        .info-bar {
            display: flex;
            gap: 30px;
            background: linear-gradient(180deg, rgba(0,204,255,0.1), transparent);
            border: 1px solid #00ccff;
            padding: 15px 40px;
            margin-bottom: 20px;
        }

        .info-item { text-align: center; }
        .info-label { font-size: 10px; color: #666; }
        .info-val { font-size: 22px; color: #00ccff; }

        .network-graph {
            width: 750px;
            height: 400px;
            background: #111;
            border: 2px solid #222;
            border-radius: 10px;
            position: relative;
        }

        svg { position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        line { stroke: #333; stroke-width: 3; }
        line.heavy { stroke: #ff9900; stroke-width: 6; filter: drop-shadow(0 0 10px #ff9900); }
        line.light { stroke: #00ccff; stroke-width: 3; stroke-dasharray: 5 3; }

        .node {
            position: absolute;
            width: 45px;
            height: 45px;
            background: #222;
            border: 3px solid #444;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            cursor: pointer;
            transition: all 0.2s;
        }
        .node:hover { border-color: #00ccff; transform: scale(1.1); }
        .node.chain-head { border-color: #ff9900; box-shadow: 0 0 20px #ff9900; }
        .node .id { font-size: 14px; color: #00ccff; }
        .node .size { font-size: 9px; color: #666; }

        .legend {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
        }

        .legend-line {
            width: 40px;
            height: 4px;
        }
        .legend-line.heavy { background: #ff9900; }
        .legend-line.light { background: #00ccff; }

        .controls { margin-top: 20px; }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #00ccff, #0088aa);
            border: none;
            color: #000;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }

    </style>
</head>
<body>

<div class="hld-ui">
    <h1>üõ£Ô∏è HIGHWAY DECOMPOSITION</h1>
    <div class="desc">HEAVY-LIGHT DECOMPOSITION: Heavy edges connect largest subtrees</div>

    <div class="info-bar">
        <div class="info-item">
            <div class="info-label">HEAVY CHAINS</div>
            <div class="info-val" id="heavyChains">0</div>
        </div>
        <div class="info-item">
            <div class="info-label">LIGHT EDGES</div>
            <div class="info-val" id="lightEdges">0</div>
        </div>
        <div class="info-item">
            <div class="info-label">MAX CHAIN LEN</div>
            <div class="info-val" id="maxChain">0</div>
        </div>
    </div>

    <div class="network-graph" id="graph">
        <svg id="edges"></svg>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-line heavy"></div>
            <span>Heavy Edge (largest subtree)</span>
        </div>
        <div class="legend-item">
            <div class="legend-line light"></div>
            <span>Light Edge</span>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="decompose()">RUN HLD</button>
    </div>
</div>

<script>
    const TREE = {
        nodes: [
            {id:1, x:355, y:20},
            {id:2, x:180, y:100}, {id:3, x:530, y:100},
            {id:4, x:80, y:200}, {id:5, x:280, y:200}, {id:6, x:430, y:200}, {id:7, x:630, y:200},
            {id:8, x:30, y:310}, {id:9, x:130, y:310}, {id:10, x:230, y:310}, {id:11, x:330, y:310}
        ],
        edges: [[1,2],[1,3],[2,4],[2,5],[3,6],[3,7],[4,8],[4,9],[5,10],[5,11]],
        children: {1:[2,3], 2:[4,5], 3:[6,7], 4:[8,9], 5:[10,11], 6:[], 7:[], 8:[], 9:[], 10:[], 11:[]},
        parent: {1:null, 2:1, 3:1, 4:2, 5:2, 6:3, 7:3, 8:4, 9:4, 10:5, 11:5}
    };

    let subtreeSize = {};
    let heavyChild = {};
    let edgeType = {}; // 'heavy' or 'light'

    function init() {
        renderGraph();
    }

    function renderGraph() {
        const graph = document.getElementById('graph');
        const svg = document.getElementById('edges');
        svg.innerHTML = '';
        graph.querySelectorAll('.node').forEach(n => n.remove());

        TREE.edges.forEach(([a, b]) => {
            const n1 = TREE.nodes.find(n => n.id === a);
            const n2 = TREE.nodes.find(n => n.id === b);
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', n1.x + 22);
            line.setAttribute('y1', n1.y + 22);
            line.setAttribute('x2', n2.x + 22);
            line.setAttribute('y2', n2.y + 22);
            line.id = `edge-${Math.min(a,b)}-${Math.max(a,b)}`;
            
            const key = `${a}-${b}`;
            const keyRev = `${b}-${a}`;
            if (edgeType[key] === 'heavy' || edgeType[keyRev] === 'heavy') {
                line.classList.add('heavy');
            } else if (edgeType[key] === 'light' || edgeType[keyRev] === 'light') {
                line.classList.add('light');
            }
            
            svg.appendChild(line);
        });

        TREE.nodes.forEach(n => {
            const el = document.createElement('div');
            el.className = 'node';
            if (heavyChild[TREE.parent[n.id]] === n.id) {
                // This is a heavy child
            }
            el.id = `node-${n.id}`;
            el.style.left = n.x + 'px';
            el.style.top = n.y + 'px';
            const sz = subtreeSize[n.id] || '?';
            el.innerHTML = `<span class="id">${n.id}</span><span class="size">sz=${sz}</span>`;
            graph.appendChild(el);
        });
    }

    function computeSubtreeSize(v) {
        let size = 1;
        for (const c of TREE.children[v]) {
            size += computeSubtreeSize(c);
        }
        subtreeSize[v] = size;
        return size;
    }

    function markHeavyEdges(v) {
        if (TREE.children[v].length === 0) return;
        
        let maxChild = null;
        let maxSize = 0;
        for (const c of TREE.children[v]) {
            if (subtreeSize[c] > maxSize) {
                maxSize = subtreeSize[c];
                maxChild = c;
            }
        }
        
        heavyChild[v] = maxChild;
        
        for (const c of TREE.children[v]) {
            if (c === maxChild) {
                edgeType[`${v}-${c}`] = 'heavy';
            } else {
                edgeType[`${v}-${c}`] = 'light';
            }
            markHeavyEdges(c);
        }
    }

    function decompose() {
        subtreeSize = {};
        heavyChild = {};
        edgeType = {};
        
        computeSubtreeSize(1);
        markHeavyEdges(1);
        
        // Count stats
        let heavyCount = 0, lightCount = 0;
        Object.values(edgeType).forEach(t => {
            if (t === 'heavy') heavyCount++;
            else lightCount++;
        });
        
        document.getElementById('heavyChains').textContent = heavyCount;
        document.getElementById('lightEdges').textContent = lightCount;
        document.getElementById('maxChain').textContent = Math.max(...Object.values(subtreeSize));
        
        renderGraph();
    }

    window.onload = init;
</script>
</body>
</html>
