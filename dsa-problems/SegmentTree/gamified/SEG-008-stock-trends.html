<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEG-008: Stock Trends</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #1e1e1e; --up: #00e676; --down: #ff5252; --neutral: #90a4ae; --text: #fff; }
        * { box-sizing: border-box; }
        body { font-family: 'Roboto Mono', monospace; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        header { width: 100%; border-bottom: 1px solid #333; padding: 15px; text-align: center; background: #252526; }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: -1px; }

        main { flex: 1; display: flex; flex-direction: column; width: 100%; max-width: 900px; padding: 20px; align-items: center; justify-content: center; }

        .chart-box {
            width: 100%; height: 350px; border: 1px solid #444; position: relative;
            background: #252526; display: flex; align-items: flex-end; justify-content: space-around;
            padding: 20px 10px; border-radius: 5px;
        }

        .candle-group {
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            width: 40px; height: 100%; cursor: pointer; position: relative;
        }
        
        .candle {
            width: 10px; background: var(--neutral); transition: all 0.3s;
            position: relative;
        }
        .candle.active { background: #fff; box-shadow: 0 0 10px #fff; width: 12px; }
        
        .wick {
            width: 2px; height: 100%; background: #666; position: absolute; top:0; left: 4px; z-index: 0;
        }

        .price-tag { margin-top: 10px; font-size: 0.8rem; color: #888; }
        .idx-tag { position: absolute; top: 0; font-size: 0.7rem; color: #555; }

        .controls { 
            margin-top: 30px; display: flex; gap: 20px; padding: 20px; background: #2d2d2d; 
            border-radius: 8px; align-items: center;
        }
        button { padding: 8px 16px; background: #007acc; color: white; border: none; cursor: pointer; font-family: inherit; border-radius: 3px; }
        button:hover { background: #005f9e; }
        input { background: #3c3c3c; border: 1px solid #555; color: #fff; padding: 5px; width: 60px; text-align: center; }

        #stats { font-size: 1.2rem; margin-bottom: 15px; color: var(--up); }
    </style>
</head>
<body>
<header>
    <h1>SEG-008 STOCK TRENDS (LIS)</h1>
    <div style="font-size:0.8rem; color:#888;">LONGEST INCREASING SUBSEQUENCE QUERY</div>
</header>
<main>
    <div id="stats">Analysis: Waiting...</div>

    <div class="chart-box" id="chart">
        <!-- Candles JS -->
    </div>

    <div class="controls">
        <div>
            <span>Update Price:</span>
            <input type="number" id="updIdx" placeholder="Idx" min="0" max="11">
            <input type="number" id="updVal" placeholder="$$" min="10" max="300">
            <button onclick="game.update()">SET</button>
        </div>
        <div style="width:1px; background:#555; height:30px;"></div>
        <div>
            <span>Query Range:</span>
            <input type="number" id="L" placeholder="L" min="0" max="11">
            <input type="number" id="R" placeholder="R" min="0" max="11">
            <button onclick="game.query()">FIND LIS</button>
        </div>
    </div>
</main>
<script>
class Game {
    constructor() {
        this.n = 12;
        this.prices = [100, 110, 90, 105, 115, 120, 80, 85, 95, 130, 100, 150];
        this.ui = {
            chart: document.getElementById('chart'),
            stats: document.getElementById('stats')
        };
        this.render();
    }

    render() {
        this.ui.chart.innerHTML = '';
        this.prices.forEach((p, i) => {
            let grp = document.createElement('div');
            grp.className = 'candle-group';
            grp.onclick = () => {
                document.getElementById('updIdx').value = i;
                document.getElementById('updVal').value = p;
            };

            let idx = document.createElement('div');
            idx.className = 'idx-tag';
            idx.innerText = i;

            let h = Math.min(p, 300);
            
            // Simplified visualization just showing bars
            let body = document.createElement('div');
            body.className = 'candle';
            body.style.height = h + 'px';
            body.style.backgroundColor = (i > 0 && p >= this.prices[i-1]) ? 'var(--up)' : 'var(--down)';
            body.id = 'bar-'+i;

            let price = document.createElement('div');
            price.className = 'price-tag';
            price.innerText = p;

            grp.appendChild(idx);
            grp.appendChild(body);
            grp.appendChild(price);
            this.ui.chart.appendChild(grp);
        });
    }

    update() {
        let i = parseInt(document.getElementById('updIdx').value);
        let v = parseInt(document.getElementById('updVal').value);
        if(!isNaN(i) && !isNaN(v) && i>=0 && i<this.n) {
            this.prices[i] = v;
            this.render();
        }
    }

    query() {
        let l = parseInt(document.getElementById('L').value);
        let r = parseInt(document.getElementById('R').value);
        
        if (isNaN(l) || isNaN(r) || l > r || l < 0 || r >= this.n) {
            this.ui.stats.innerText = "Invalid Range";
            return;
        }

        // Calculate LIS O(N^2) here for visual confirmation
        // Real SEG tree uses merging of nodes O(log N)
        let sub = this.prices.slice(l, r+1);
        let lis = [];
        let path = []; // store indices relative to sub
        
        // Basic LIS DP to find length
        let dp = new Array(sub.length).fill(1);
        let parent = new Array(sub.length).fill(-1);
        
        let maxLen = 0;
        let maxEndObj = -1;

        for (let i = 0; i < sub.length; i++) {
            for (let j = 0; j < i; j++) {
                if (sub[j] < sub[i] && dp[i] < dp[j] + 1) {
                    dp[i] = dp[j] + 1;
                    parent[i] = j;
                }
            }
            if (dp[i] > maxLen) {
                maxLen = dp[i];
                maxEndObj = i;
            }
        }

        // Reconstruct path
        let curr = maxEndObj;
        let hlIndices = [];
        while(curr !== -1) {
            hlIndices.push(l + curr);
            curr = parent[curr];
        }

        // Visualize
        document.querySelectorAll('.candle').forEach(e => e.classList.remove('active'));
        hlIndices.forEach(idx => {
            document.getElementById('bar-'+idx).classList.add('active');
        });

        this.ui.stats.innerText = `Longest Increasing Trend in [${l}, ${r}] Length: ${maxLen}`;
    }
}
const game = new Game();
</script>
</body>
</html>
