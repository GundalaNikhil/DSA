<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REC-004: Seat Arranger</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f5f5f5;
            --surface: #fff;
            --primary: #5e35b1;
            --secondary: #7e57c2;
            --accent: #ffab00;
            --success: #43a047;
            --text: #212121;
            --muted: #757575;
            --seat: #e1bee7;
            --occupied: #5e35b1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

        header { background: var(--surface); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { font-size: 1.3rem; color: var(--primary); }
        .subtitle { color: var(--muted); font-size: 0.85rem; }

        .btn { background: var(--primary); color: #fff; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-family: inherit; font-weight: 600; transition: all 0.3s; }
        .btn:hover { background: var(--secondary); }
        .btn-outline { background: transparent; color: var(--primary); border: 2px solid var(--primary); }

        main { padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; max-width: 700px; margin: 0 auto; }

        .info-card { background: var(--surface); padding: 1.5rem; border-radius: 12px; width: 100%; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .info-card p { color: var(--muted); line-height: 1.6; }

        .config-panel { background: var(--surface); padding: 1rem; border-radius: 12px; width: 100%; display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .config-item { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .config-item label { color: var(--muted); font-size: 0.85rem; }
        .config-item input { padding: 8px 12px; border: 2px solid var(--muted); border-radius: 8px; width: 60px; text-align: center; font-family: inherit; }

        .seats-container { background: var(--surface); padding: 1.5rem; border-radius: 12px; width: 100%; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .seats-container h3 { color: var(--muted); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 1rem; text-align: center; }

        .seats-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }

        .seat { width: 45px; height: 45px; background: var(--seat); border-radius: 10px 10px 5px 5px; display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--muted); transition: all 0.3s; position: relative; }
        .seat.occupied { background: var(--occupied); color: #fff; }
        .seat.considering { border: 3px solid var(--accent); }
        .seat .idx { position: absolute; bottom: -18px; font-size: 0.7rem; color: var(--muted); }

        .gap-indicator { display: flex; align-items: center; color: var(--accent); font-size: 0.8rem; padding: 0 5px; }

        .result-panel { background: var(--surface); padding: 1.5rem; border-radius: 12px; width: 100%; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .result-panel h3 { color: var(--success); margin-bottom: 1rem; text-align: center; }
        .arrangement-list { display: flex; flex-direction: column; gap: 8px; max-height: 150px; overflow-y: auto; }
        .arrangement-item { background: var(--bg); padding: 10px; border-radius: 8px; font-family: 'Fira Code'; text-align: center; }

        .count-display { font-size: 2rem; font-weight: 700; color: var(--primary); text-align: center; margin-top: 0.5rem; }

        .controls { display: flex; gap: 1rem; }

        .modal { position: fixed; inset: 0; background: rgba(33, 33, 33, 0.9); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .modal.hidden { display: none; }
        .dialog { background: var(--surface); padding: 2rem; border-radius: 15px; max-width: 480px; }
        .dialog h2 { color: var(--primary); margin-bottom: 1rem; }
        .dialog p { margin: 0.8rem 0; line-height: 1.7; color: var(--text); }
    </style>
</head>
<body>

<header>
    <div>
        <h1>ðŸ’º Seat Arranger</h1>
        <div class="subtitle">REC-004: Exam Seating Backtrack</div>
    </div>
    <button class="btn btn-outline" onclick="showProtocol()">Protocol</button>
</header>

<main>
    <div class="info-card">
        <p>Place <strong>k students</strong> in <strong>n seats</strong> with at least <strong>d empty seats</strong> between any two. Count all valid arrangements!</p>
    </div>

    <div class="config-panel">
        <div class="config-item"><label>Seats (n)</label><input type="number" id="nInput" value="5" min="1" max="12"></div>
        <div class="config-item"><label>Students (k)</label><input type="number" id="kInput" value="2" min="0" max="6"></div>
        <div class="config-item"><label>Gap (d)</label><input type="number" id="dInput" value="2" min="0" max="5"></div>
    </div>

    <div class="seats-container">
        <h3>Exam Hall Seats</h3>
        <div class="seats-row" id="seatsRow"></div>
    </div>

    <div class="result-panel">
        <h3>Valid Arrangements</h3>
        <div class="arrangement-list" id="arrangementList"></div>
        <div class="count-display" id="countDisplay">0</div>
    </div>

    <div class="controls">
        <button class="btn" onclick="findArrangements()">Find Arrangements</button>
        <button class="btn btn-outline" onclick="reset()">Reset</button>
    </div>
</main>

<div id="modal" class="modal hidden">
    <div class="dialog">
        <h2>ðŸ’º Seat Arranger Guide</h2>
        <p><strong>The Problem:</strong></p>
        <p>Place k students in n seats such that any two have at least d empty seats between them.</p>
        <p><strong>Key Insight:</strong></p>
        <p>If student at seat i, next must be at seat â‰¥ i + d + 1</p>
        <p><strong>Backtracking:</strong></p>
        <p>Try placing each student at each valid seat, pruning when remaining seats are insufficient.</p>
        <button class="btn" onclick="hideProtocol()" style="margin-top:1rem;">Start Arranging!</button>
    </div>
</div>

<script>
    function showProtocol() { document.getElementById('modal').classList.remove('hidden'); }
    function hideProtocol() { document.getElementById('modal').classList.add('hidden'); }

    function reset() {
        renderSeats();
        document.getElementById('arrangementList').innerHTML = '';
        document.getElementById('countDisplay').textContent = '0';
    }

    function renderSeats() {
        const n = parseInt(document.getElementById('nInput').value);
        const row = document.getElementById('seatsRow');
        row.innerHTML = '';
        
        for (let i = 0; i < n; i++) {
            const seat = document.createElement('div');
            seat.className = 'seat';
            seat.id = `seat-${i}`;
            seat.innerHTML = `<span class="idx">${i}</span>`;
            row.appendChild(seat);
        }
    }

    async function findArrangements() {
        const n = parseInt(document.getElementById('nInput').value);
        const k = parseInt(document.getElementById('kInput').value);
        const d = parseInt(document.getElementById('dInput').value);

        document.getElementById('arrangementList').innerHTML = '';
        const results = [];
        
        await backtrack(n, k, d, -1, 0, [], results);
        
        document.getElementById('countDisplay').textContent = results.length;
        if (results.length === 0) {
            document.getElementById('arrangementList').innerHTML = '<div class="arrangement-item" style="color:var(--muted)">No valid arrangement</div>';
        }
    }

    async function backtrack(n, k, d, lastSeat, placed, current, results) {
        if (placed === k) {
            results.push([...current]);
            const item = document.createElement('div');
            item.className = 'arrangement-item';
            item.textContent = `(${current.join(', ')})`;
            document.getElementById('arrangementList').appendChild(item);
            return;
        }

        const minNext = lastSeat + d + 1;
        const remaining = k - placed;
        
        for (let seat = Math.max(0, minNext); seat < n; seat++) {
            // Prune: not enough seats left
            const seatsLeft = n - seat;
            const needed = remaining + (remaining - 1) * d;
            if (seatsLeft < needed) break;

            document.getElementById(`seat-${seat}`).classList.add('considering');
            await sleep(80);
            document.getElementById(`seat-${seat}`).classList.add('occupied');
            document.getElementById(`seat-${seat}`).textContent = placed + 1;

            await backtrack(n, k, d, seat, placed + 1, [...current, seat], results);

            document.getElementById(`seat-${seat}`).classList.remove('occupied', 'considering');
            document.getElementById(`seat-${seat}`).textContent = '';
        }
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    window.onload = renderSeats;
</script>
</body>
</html>
