<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REC-009: Calculator Hack</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #222;
            --screen: #333;
            --text: #0f0;
            --key: #444;
            --key-text: #fff;
            --highlight: #2ecc71;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { margin-top: 2rem; color: #fff; text-shadow: 0 0 5px #fff; }

        .device {
            background: #111;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            margin-top: 2rem;
            width: 400px;
            border: 2px solid #555;
        }

        .screen {
            background: var(--screen);
            color: var(--text);
            font-size: 2rem;
            padding: 20px;
            border-radius: 10px;
            text-align: right;
            margin-bottom: 20px;
            font-weight: bold;
            box-shadow: inset 0 0 10px #000;
            min-height: 50px;
        }

        .expression-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: #fff;
        }

        .digit { font-weight: bold; }
        
        .op-slot {
            width: 40px;
            height: 40px;
            background: #444;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #ff9f43;
            font-weight: bold;
            transition: all 0.2s;
        }
        .op-slot:hover { background: #555; }
        .op-slot.active { border: 2px solid #fff; }

        .controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .btn {
            background: var(--key);
            color: var(--key-text);
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-family: inherit;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .btn:active { transform: translateY(2px); }
        .btn.op { background: #576574; }
        .btn.action { background: #d63031; }
        .btn.flip { background: #9b59b6; }

        .target-box { text-align: center; color: #7f8fa6; margin-bottom: 10px; }

    </style>
</head>
<body>

<h1>CALCULATOR HACK</h1>

<div class="device">
    <div class="target-box">Target: <span id="target" style="color:#fff; font-size:1.2rem">42</span></div>
    
    <div class="screen" id="currentEval">0</div>

    <div class="expression-row" id="expr">
        <!-- Generated: 1 [?] 2 [?] 3 -->
    </div>

    <div class="controls">
        <button class="btn op" onclick="setOp('+')">+</button>
        <button class="btn op" onclick="setOp('-')">−</button>
        <button class="btn op" onclick="setOp('*')">×</button>
        <button class="btn op" onclick="setOp('')">_</button> <!-- Concat -->
        
        <button class="btn flip" id="flipBtn" onclick="toggleFlip()">FLIP</button>
        <button class="btn action" onclick="reset()">CLR</button>
    </div>
    
    <div style="text-align:center; margin-top:15px; color:#666; font-size:0.8rem">
        Click a slot, then pick operator. "FLIP" toggles unary minus for ONE number.
    </div>
</div>

<script>
    const DIGITS = "12345";
    const TARGET = 57; // 12 + 3 * 45? = 147. 1+23+45 = 69...
    // Let's make it solvable. "123", target 6. 1+2+3=6.
    // "123", target 0. 1+2-3=0.
    
    let ops = []; // length DIGITS.length - 1
    let flipIndex = -1; // Index of digit active flipped (-x)
    let selectedSlot = 0;

    function init() {
        ops = new Array(DIGITS.length - 1).fill('+');
        document.getElementById('target').textContent = TARGET;
        render();
    }

    function render() {
        const row = document.getElementById('expr');
        row.innerHTML = '';
        
        for (let i=0; i<DIGITS.length; i++) {
            // Digit
            const dSpan = document.createElement('span');
            dSpan.className = 'digit';
            dSpan.textContent = DIGITS[i];
            
            // If flipped?
            if (flipIndex === i) {
                const f = document.createElement('span');
                f.textContent = '(-';
                f.style.color = '#9b59b6';
                row.appendChild(f);
                row.appendChild(dSpan);
                const c = document.createElement('span');
                c.textContent = ')';
                c.style.color = '#9b59b6';
                row.appendChild(c);
            } else {
                row.appendChild(dSpan);
            }

            // Op Slot
            if (i < DIGITS.length - 1) {
                const s = document.createElement('div');
                s.className = 'op-slot';
                s.textContent = ops[i] === '' ? '_' : ops[i];
                if (selectedSlot === i) s.classList.add('active');
                s.onclick = () => { selectedSlot = i; render(); };
                row.appendChild(s);
            }
        }

        evaluate();
    }

    function setOp(op) {
        if (selectedSlot >= 0 && selectedSlot < ops.length) {
            ops[selectedSlot] = op;
            // Auto advance
            selectedSlot = (selectedSlot + 1) % ops.length;
            render();
        }
    }

    function toggleFlip() {
        // Simple logic: Cycles through flip pos for demo
        flipIndex = (flipIndex + 2) % (DIGITS.length + 1) - 1; 
        // -1 (none), 0, 1...
        render();
    }
    
    function reset() {
        ops.fill('+');
        flipIndex = -1;
        selectedSlot = 0;
        render();
    }

    function evaluate() {
        // Construct string
        let s = "";
        for (let i=0; i<DIGITS.length; i++) {
            if (flipIndex === i) s += "-";
            s += DIGITS[i];
            if (i < ops.length) {
                // If op is '', just concat
                if (ops[i] !== '') s += ops[i];
            }
        }
        
        // Eval safe
        try {
            // Replace '' with nothing (concat happened in loop basically by not adding op)
            // wait "1" + "" + "2" is "12" in loop.
            // Check double operators? "-1--2"?
            // Eval logic:
            // "1" + "+" + "2" => 1+2
            // "1" + "" + "2" => 12
            // "-1" + "+" + "2" => -1+2
            
            // This eval is naive but sufficient for game demo
            // Note: problem allowed ONE flip.
            
            const result = eval(s);
            const disp = document.getElementById('currentEval');
            disp.textContent = result;
            
            if (result === TARGET) {
                disp.style.color = "#2ecc71";
                disp.textContent = "MATCH!";
            } else {
                disp.style.color = "#fff";
            }
        } catch (e) {
            document.getElementById('currentEval').textContent = "ERR";
        }
    }

    window.onload = init;
</script>
</body>
</html>
