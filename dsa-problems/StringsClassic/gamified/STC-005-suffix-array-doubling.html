<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STC-005: Suffix Sorter</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ecf0f1;
            --text: #2c3e50;
            --card: #fff;
            --accent: #3498db;
            --correct: #2ecc71;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        h1 { margin-top: 2rem; }

        .suffix-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 2rem;
            padding: 20px;
            background: var(--card);
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            min-width: 400px;
        }

        .suffix-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: grab;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .suffix-item:active { cursor: grabbing; }
        .suffix-item.dragging { opacity: 0.5; border-color: var(--accent); }
        .suffix-item.over { border-color: var(--correct); }

        .idx { font-weight: bold; color: var(--accent); width: 30px; }
        .suffix-text { flex: 1; }

        .controls { margin-top: 2rem; display: flex; gap: 20px; }

        .btn {
            padding: 10px 25px;
            border: none;
            background: var(--accent);
            color: #fff;
            font-family: inherit;
            cursor: pointer;
            border-radius: 5px;
        }
        .btn:hover { background: #2980b9; }

        .status { margin-top: 1rem; min-height: 1.5em; }

    </style>
</head>
<body>

<h1>SUFFIX SORTER</h1>
<div style="color:#7f8c8d">Drag suffixes into lexicographic order.</div>

<div class="suffix-list" id="list"></div>

<div class="controls">
    <button class="btn" onclick="check()">CHECK ORDER</button>
    <button class="btn" onclick="init()">NEW STRING</button>
</div>

<div class="status" id="status"></div>

<script>
    const STRINGS = ["cababa", "banana", "abcabc", "mississippi"];
    let str = "";
    let suffixes = [];
    let draggedIdx = null;

    function init() {
        str = STRINGS[Math.floor(Math.random() * STRINGS.length)];
        suffixes = [];
        for (let i = 0; i < str.length; i++) {
            suffixes.push({ idx: i, text: str.substring(i) });
        }
        // Shuffle
        suffixes.sort(() => Math.random() - 0.5);
        render();
        document.getElementById('status').textContent = "";
    }

    function render() {
        const list = document.getElementById('list');
        list.innerHTML = '';

        suffixes.forEach((s, i) => {
            const item = document.createElement('div');
            item.className = 'suffix-item';
            item.draggable = true;
            item.innerHTML = `<span class="idx">${s.idx}</span><span class="suffix-text">${s.text}</span>`;
            
            item.ondragstart = () => { draggedIdx = i; item.classList.add('dragging'); };
            item.ondragend = () => { draggedIdx = null; item.classList.remove('dragging'); };
            item.ondragover = (e) => { e.preventDefault(); item.classList.add('over'); };
            item.ondragleave = () => item.classList.remove('over');
            item.ondrop = (e) => {
                e.preventDefault();
                item.classList.remove('over');
                if (draggedIdx !== null && draggedIdx !== i) {
                    // Swap
                    const temp = suffixes[draggedIdx];
                    suffixes.splice(draggedIdx, 1);
                    suffixes.splice(i, 0, temp);
                    render();
                }
            };

            list.appendChild(item);
        });
    }

    function check() {
        // Build expected suffix array
        const sorted = [...Array(str.length).keys()].sort((a, b) => {
            return str.substring(a).localeCompare(str.substring(b));
        });

        const userOrder = suffixes.map(s => s.idx);
        let correct = true;
        for (let i = 0; i < sorted.length; i++) {
            if (sorted[i] !== userOrder[i]) {
                correct = false;
                break;
            }
        }

        const status = document.getElementById('status');
        if (correct) {
            status.textContent = "CORRECT! Suffix Array: " + userOrder.join(', ');
            status.style.color = "#2ecc71";
        } else {
            status.textContent = "Incorrect order. Try again!";
            status.style.color = "#e74c3c";
        }
    }

    window.onload = init;
</script>
</body>
</html>
