<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STC-015: Pattern Patrol</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #222;
            --text: #fff;
            --found: #ffd700;
            --cooldown: #ff6b6b;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-size: 10px;
        }

        h1 { color: var(--found); margin-top: 2rem; font-size: 1.5rem; }

        .game-area {
            margin-top: 2rem;
            padding: 20px;
            background: #333;
            border-radius: 10px;
        }

        .text-stream {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            max-width: 600px;
            margin: 15px 0;
        }

        .char {
            width: 25px;
            height: 30px;
            background: #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 3px;
        }
        .char.matched { background: var(--found); color: #000; }
        .char.cooldown { background: var(--cooldown); color: #fff; }

        .patterns-box {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .pattern-tag {
            padding: 8px 12px;
            background: #555;
            border-radius: 5px;
            font-size: 10px;
        }
        .pattern-tag span { color: var(--found); }

        .scorer {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .score-box { text-align: center; }
        .score-val { font-size: 24px; color: var(--found); }

        .btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--found);
            border: none;
            color: #000;
            font-family: inherit;
            cursor: pointer;
            border-radius: 5px;
        }

    </style>
</head>
<body>

<h1>PATTERN PATROL</h1>
<div style="color:#888; margin-top:10px; font-size:8px">AHO-CORASICK: Find patterns with cooldowns</div>

<div class="game-area">
    <div>Text Stream:</div>
    <div class="text-stream" id="stream"></div>

    <div>Patterns (with cooldown):</div>
    <div class="patterns-box" id="patterns"></div>

    <div class="scorer">
        <div class="score-box">
            <div>SCORE</div>
            <div class="score-val" id="score">0</div>
        </div>
        <div class="score-box">
            <div>MATCHES</div>
            <div class="score-val" id="matches">0</div>
        </div>
    </div>
</div>

<button class="btn" onclick="scan()">SCAN TEXT</button>
<button class="btn" style="background:#555; color:#fff" onclick="init()">NEW</button>

<script>
    const TEXT = "abcabcababcabc";
    const PATTERNS = [
        { p: "abc", score: 10, cooldown: 3 },
        { p: "ab", score: 5, cooldown: 2 }
    ];

    let results = [];

    function init() {
        document.getElementById('score').textContent = '0';
        document.getElementById('matches').textContent = '0';
        renderPatterns();
        renderStream([]);
    }

    function renderPatterns() {
        const div = document.getElementById('patterns');
        div.innerHTML = '';
        PATTERNS.forEach(pat => {
            const tag = document.createElement('div');
            tag.className = 'pattern-tag';
            tag.innerHTML = `"${pat.p}" <span>+${pat.score}</span> (CD:${pat.cooldown})`;
            div.appendChild(tag);
        });
    }

    function renderStream(highlights) {
        const div = document.getElementById('stream');
        div.innerHTML = '';

        for (let i = 0; i < TEXT.length; i++) {
            const c = document.createElement('div');
            c.className = 'char';
            c.textContent = TEXT[i];

            const h = highlights.find(h => i >= h.start && i < h.start + h.len);
            if (h) {
                if (h.type === 'match') c.classList.add('matched');
                else if (h.type === 'cooldown') c.classList.add('cooldown');
            }

            div.appendChild(c);
        }
    }

    function scan() {
        // Simple multi-pattern matching with cooldown
        let totalScore = 0;
        let matchCount = 0;
        const highlights = [];
        const lastMatch = {};

        PATTERNS.forEach(pat => lastMatch[pat.p] = -Infinity);

        for (let i = 0; i < TEXT.length; i++) {
            PATTERNS.forEach(pat => {
                if (TEXT.substring(i, i + pat.p.length) === pat.p) {
                    const sinceLast = i - lastMatch[pat.p];
                    if (sinceLast >= pat.cooldown + pat.p.length) {
                        totalScore += pat.score;
                        matchCount++;
                        lastMatch[pat.p] = i;
                        highlights.push({ start: i, len: pat.p.length, type: 'match' });
                    } else {
                        highlights.push({ start: i, len: pat.p.length, type: 'cooldown' });
                    }
                }
            });
        }

        document.getElementById('score').textContent = totalScore;
        document.getElementById('matches').textContent = matchCount;
        renderStream(highlights);
    }

    window.onload = init;
</script>
</body>
</html>
