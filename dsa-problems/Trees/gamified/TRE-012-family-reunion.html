<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRE-012: Family Reunion</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --wood: #8b4513; --paper: #fdf5e6; --heart: #e74c3c; --selected: #f1c40f; --found: #27ae60; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Lato', sans-serif; background: linear-gradient(180deg, #ffecd2 0%, #fcb69f 100%); min-height: 100vh; }
        header { background: var(--wood); padding: 15px; text-align: center; color: #fff; }
        h1 { font-family: 'Pacifico', cursive; font-size: 1.8rem; color: var(--paper); }
        main { padding: 20px; max-width: 900px; margin: 0 auto; }
        .family-tree { background: var(--paper); border: 8px solid var(--wood); border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); min-height: 350px; }
        .tree-title { font-family: 'Pacifico', cursive; color: var(--wood); text-align: center; font-size: 1.3rem; margin-bottom: 20px; }
        .tree-container { display: flex; flex-direction: column; align-items: center; gap: 30px; }
        .tree-level { display: flex; gap: 25px; }
        .member { width: 60px; height: 80px; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: all 0.3s; }
        .member:hover { transform: scale(1.1); }
        .avatar { font-size: 2.5rem; }
        .name { background: #fff; padding: 3px 10px; border-radius: 10px; font-weight: bold; color: var(--wood); margin-top: 5px; border: 2px solid transparent; }
        .member.selected .name { border-color: var(--selected); background: var(--selected); }
        .member.lca .name { border-color: var(--found); background: var(--found); color: #fff; }
        .member.lca .avatar { animation: celebrate 0.5s ease; }
        @keyframes celebrate { 0%,100% { transform: scale(1); } 50% { transform: scale(1.3); } }
        .controls { display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap; align-items: center; }
        .selection { background: var(--paper); padding: 10px 20px; border-radius: 10px; border: 2px solid var(--wood); }
        .btn { padding: 15px 25px; border: none; border-radius: 10px; font-family: 'Pacifico', cursive; font-size: 1rem; cursor: pointer; }
        .btn-find { background: var(--heart); color: #fff; }
        .btn-reset { background: var(--wood); color: #fff; }
        .btn:hover { transform: scale(1.05); }
        .result { background: var(--paper); border: 3px solid var(--found); border-radius: 15px; padding: 20px; margin-top: 20px; text-align: center; display: none; }
        .result.show { display: block; }
        .result-title { color: var(--found); font-family: 'Pacifico', cursive; font-size: 1.3rem; }
        .result-lca { font-size: 3rem; margin-top: 10px; }
        #message { text-align: center; color: var(--wood); padding: 10px; font-size: 1.1rem; }
    </style>
</head>
<body>
<header>
    <h1>üë®‚Äçüë©‚Äçüëß Family Reunion</h1>
</header>
<main>
    <div id="message">Click two family members to find their meeting point!</div>
    <div class="family-tree">
        <div class="tree-title">üìú Family Tree</div>
        <div class="tree-container" id="tree"></div>
    </div>
    <div class="controls">
        <div class="selection">Selected: <span id="selected">None</span></div>
        <button class="btn btn-find" onclick="game.findLCA()">‚ù§Ô∏è FIND MEETING POINT</button>
        <button class="btn btn-reset" onclick="game.reset()">üîÑ RESET</button>
    </div>
    <div class="result" id="result">
        <div class="result-title">üéâ Meeting Point Found!</div>
        <div class="result-lca" id="lca-result"></div>
    </div>
</main>
<script>
class FamilyReunion {
    constructor() {
        this.tree = { val: 1, name: 'Grandpa', emoji: 'üë¥', left: { val: 2, name: 'Dad', emoji: 'üë®', left: { val: 4, name: 'Son', emoji: 'üë¶' }, right: { val: 5, name: 'Daughter', emoji: 'üëß' } }, right: { val: 3, name: 'Uncle', emoji: 'üë®‚Äçü¶∞', left: { val: 6, name: 'Cousin1', emoji: 'üßí' }, right: { val: 7, name: 'Cousin2', emoji: 'üë∂' } } };
        this.selected = [];
        this.nodeMap = {};
        this.parentMap = {};
        this.buildMaps(this.tree, null);
        this.render();
    }
    buildMaps(node, parent) {
        if (!node) return;
        this.nodeMap[node.val] = node;
        this.parentMap[node.val] = parent;
        this.buildMaps(node.left, node);
        this.buildMaps(node.right, node);
    }
    render() {
        const container = document.getElementById('tree');
        container.innerHTML = '';
        const levels = [[this.tree]];
        let queue = [this.tree];
        while (queue.length) {
            const next = [];
            queue.forEach(n => { if (n.left) next.push(n.left); if (n.right) next.push(n.right); });
            if (next.length) levels.push(next);
            queue = next;
        }
        levels.forEach(level => {
            const row = document.createElement('div');
            row.className = 'tree-level';
            level.forEach(node => {
                const el = document.createElement('div');
                el.className = 'member';
                el.id = `member-${node.val}`;
                el.innerHTML = `<span class="avatar">${node.emoji}</span><span class="name">${node.name}</span>`;
                el.onclick = () => this.select(node.val);
                row.appendChild(el);
            });
            container.appendChild(row);
        });
    }
    select(val) {
        if (this.selected.length >= 2) return;
        if (this.selected.includes(val)) return;
        this.selected.push(val);
        document.getElementById(`member-${val}`).classList.add('selected');
        document.getElementById('selected').textContent = this.selected.map(v => this.nodeMap[v].name).join(' & ');
    }
    findLCA() {
        if (this.selected.length !== 2) {
            document.getElementById('message').textContent = 'Please select exactly 2 family members!';
            return;
        }
        const [u, v] = this.selected;
        const ancestors = new Set();
        let curr = u;
        while (curr !== null) {
            ancestors.add(curr);
            curr = this.parentMap[curr]?.val ?? null;
        }
        curr = v;
        let lca = null;
        while (curr !== null) {
            if (ancestors.has(curr)) { lca = curr; break; }
            curr = this.parentMap[curr]?.val ?? null;
        }
        if (lca !== null) {
            const lcaNode = this.nodeMap[lca];
            document.getElementById(`member-${lca}`).classList.add('lca');
            document.getElementById('lca-result').innerHTML = `${lcaNode.emoji} ${lcaNode.name}`;
            document.getElementById('result').classList.add('show');
            document.getElementById('message').textContent = `${this.nodeMap[u].name} and ${this.nodeMap[v].name} meet at ${lcaNode.name}!`;
        }
    }
    reset() {
        this.selected = [];
        document.querySelectorAll('.member').forEach(m => m.classList.remove('selected', 'lca'));
        document.getElementById('selected').textContent = 'None';
        document.getElementById('result').classList.remove('show');
        document.getElementById('message').textContent = 'Click two family members!';
    }
}
const game = new FamilyReunion();
</script>
</body>
</html>
