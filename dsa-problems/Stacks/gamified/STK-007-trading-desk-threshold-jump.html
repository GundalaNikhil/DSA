<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STK-007: Jump Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #131722;
            --candle-up: #00b894;
            --candle-down: #d63031;
            --text: #dfe6e9;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { margin-top: 1rem; }

        .chart-contain {
            position: relative;
            width: 800px;
            height: 400px;
            border: 1px solid #2d3436;
            margin-top: 2rem;
            background: linear-gradient(#1e272e 1px, transparent 1px), linear-gradient(90deg, #1e272e 1px, transparent 1px);
            background-size: 40px 40px;
            display: flex;
            align-items: flex-end;
            padding: 0 40px; /* Side padding */
        }

        .bar-wrapper {
            flex: 1;
            height: 100%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }

        .bar-wrapper:hover { background: rgba(255,255,255,0.05); }

        .bar {
            width: 60%;
            background: #74b9ff;
            transition: all 0.2s;
            position: relative;
        }
        
        .jump-marker {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--candle-up);
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .jump-marker.visible { opacity: 1; }

        .threshold-line {
            position: absolute;
            left: 0; right: 0;
            border-top: 2px dashed #e17055;
            z-index: 10;
            pointer-events: none;
        }

        .info-panel { text-align: center; margin-top: 20px; }
        .msg { font-size: 1.2rem; color: #a29bfe; }
    </style>
</head>
<body>

<h1>JUMP MARKET</h1>
<div style="font-size:0.9rem">Click bars where price is > (Previous Price + Threshold).</div>

<div class="chart-contain" id="chart">
    <div class="threshold-line" id="threshLine" style="display:none"></div> <!-- Visual aid maybe? No, relative. -->
</div>

<div class="info-panel">
    <div>Threshold (K): <span id="kVal">10</span></div>
    <div class="msg" id="msg">Find the jumps!</div>
    <div style="margin-top:10px">Found: <span id="found">0</span> / <span id="total">?</span></div>
</div>

<button style="margin-top:20px; padding:10px 20px" onclick="init()">New Market</button>

<script>
    const N = 12;
    let prices = [];
    let k = 10;
    let jumps = new Set();
    let found = new Set();

    function init() {
        const chart = document.getElementById('chart');
        chart.innerHTML = '';
        prices = [];
        found.clear();
        jumps.clear();

        k = 10 + Math.floor(Math.random() * 20); // 10-30
        document.getElementById('kVal').textContent = k;

        // Generate data with trend
        let p = 50;
        for(let i=0; i<N; i++) {
            p += Math.floor(Math.random() * 60) - 20; // -20 to +40
            if (p < 10) p = 10;
            prices.push(p);
            
            // Check logic
            // Problem STK-007: Threshold Jump.
            // Usually "Find first element to left that is >= X + K".
            // Or "Find next ...".
            // Let's assume standard: Find Indices where Price[i] >= Price[i-1] + K?
            // "Threshold Jump" usually implies finding moments where change is drastic.
            // Let's stick to simplest interpretation for game: 
            // Click bars where Price[i] - Price[i-1] >= K.
            
            if (i > 0 && prices[i] - prices[i-1] >= k) {
                jumps.add(i);
            }
        }
        
        document.getElementById('total').textContent = jumps.size;
        document.getElementById('found').textContent = 0;
        
        render();
    }

    function render() {
        const chart = document.getElementById('chart');
        
        prices.forEach((h, i) => {
            const wrap = document.createElement('div');
            wrap.className = 'bar-wrapper';
            wrap.onclick = () => check(i, wrap);
            
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = h + 'px';
            
            // Color based on prev?
            if (i > 0) {
                bar.style.background = prices[i] >= prices[i-1] ? '#00b894' : '#d63031';
            }
            
            const mk = document.createElement('div');
            mk.className = 'jump-marker';
            mk.textContent = 'âš¡';
            wrap.appendChild(mk);

            wrap.appendChild(bar);
            chart.appendChild(wrap);
        });
    }

    function check(i, el) {
        if (jumps.has(i)) {
            if (!found.has(i)) {
                found.add(i);
                el.querySelector('.jump-marker').classList.add('visible');
                document.getElementById('msg').textContent = `Correct! Jump of ${prices[i]-prices[i-1]}`;
                document.getElementById('found').textContent = found.size;
            }
        } else {
            document.getElementById('msg').textContent = "No valid jump there.";
            // Shake?
        }
    }

    window.onload = init;
</script>
</body>
</html>
