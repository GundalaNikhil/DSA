<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STK-013: Temple Door</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #1a1a1a; --stone: #795548; --gold: #ffd700; }
        * { box-sizing: border-box; }
        body { font-family: 'Cinzel', serif; background: var(--bg); color: #fff; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow: hidden; }

        header { padding: 20px; font-size: 2rem; color: #8d6e63; text-shadow: 2px 2px 0 #000; }
        
        .wall {
            display: flex; align-items: flex-end; justify-content: center; gap: 0;
            width: 800px; height: 400px; border-bottom: 20px solid #3e2723; background: #000;
            position: relative; margin-top: 20px;
        }

        .column {
            width: 50px; background: url('data:image/svg+xml;utf8,<svg width="50" height="50" xmlns="http://www.w3.org/2000/svg"><rect width="50" height="50" fill="%235d4037"/><path d="M0 0 L50 50 M50 0 L0 50" stroke="%234e342e" stroke-width="2"/></svg>');
            border: 1px solid #3e2723; cursor: crosshair; transition: filter 0.2s; position: relative;
        }
        .column:hover { filter: brightness(1.2); }

        .hidden-door {
            position: absolute; bottom: 0; background: rgba(255, 215, 0, 0.4); border: 4px solid var(--gold);
            pointer-events: none; opacity: 0; transition: opacity 0.5s;
            display: flex; align-items: center; justify-content: center; font-size: 3rem; text-shadow: 0 0 10px #000; z-index: 10;
        }
        
        .measure-tool {
            position: absolute; top: 20px; left: 0; height: 5px; background: #fff; pointer-events: none; opacity: 0;
        }
        
        .controls { margin-top: 30px; display: flex; gap: 20px; }
        .btn { padding: 15px 30px; font-family: 'Cinzel'; font-size: 1.2rem; cursor: pointer; border: 2px solid #8d6e63; background: #3e2723; color: #fff; }
        .btn:hover { background: #5d4037; }

        #res { position: absolute; top: 100px; font-size: 1.5rem; color: var(--gold); pointer-events: none; }
    </style>
</head>
<body>
<header>STK-013 TEMPLE DOOR (Histogram Area)</header>
<div id="res">Select a pillar to expand the Golden Door!</div>

<div class="wall" id="wall">
    <div class="hidden-door" id="door"></div>
</div>

<div class="controls">
    <button class="btn" onclick="game.regen()">NEW WALL</button>
</div>

<script>
class Game {
    constructor() {
        this.n = 16;
        this.heights = [];
        this.ui = { wall: document.getElementById('wall'), door: document.getElementById('door'), res: document.getElementById('res') };
        this.regen();
    }

    regen() {
        this.heights = [];
        // Clear columns (keep door)
        Array.from(this.ui.wall.children).forEach(c => { if(c.id !== 'door') c.remove(); });
        this.ui.door.style.opacity = 0;
        this.ui.res.innerText = "Click a starting pillar...";

        for(let i=0; i<this.n; i++) {
            let h = Math.floor(Math.random()*300) + 50;
            this.heights.push(h);
            
            let c = document.createElement('div');
            c.className = 'column';
            c.style.height = h + 'px';
            c.onclick = () => this.scanArea(i);
            this.ui.wall.appendChild(c);
        }
    }

    async scanArea(idx) {
        let h = this.heights[idx];
        let l = idx, r = idx;
        
        // Visual Scan Left
        while(l >= 0 && this.heights[l] >= h) {
            this.highlight(l, 'brightness(1.5)');
            await new Promise(r => setTimeout(r, 50));
            this.highlight(l, '');
            l--;
        }
        l++; // fix range
        
        // Visual Scan Right
        while(r < this.n && this.heights[r] >= h) {
            this.highlight(r, 'brightness(1.5)');
            await new Promise(r => setTimeout(r, 50));
            this.highlight(r, '');
            r++;
        }
        r--; // fix range
        
        // Show Door
        let cols = this.ui.wall.querySelectorAll('.column');
        let leftCol = cols[l].getBoundingClientRect();
        let rightCol = cols[r].getBoundingClientRect();
        let wallRect = this.ui.wall.getBoundingClientRect();
        
        this.ui.door.style.left = (leftCol.left - wallRect.left) + 'px';
        this.ui.door.style.width = (rightCol.right - leftCol.left) + 'px';
        this.ui.door.style.height = h + 'px';
        this.ui.door.style.opacity = 1;
        this.ui.door.innerText = (h * (r - l + 1));
        
        this.ui.res.innerText = `Door Area: ${h} x ${r-l+1} = ${h * (r-l+1)}`;
    }
    
    highlight(i, val) {
        let c = this.ui.wall.querySelectorAll('.column')[i];
        if(c) c.style.filter = val;
    }
}
const game = new Game();
</script>
</body>
</html>
