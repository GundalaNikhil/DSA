<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STK-003: Orb Blaster</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #102027; --tube: #37474f; --text: #eceff1; }
        * { box-sizing: border-box; }
        body { font-family: 'Fredoka One', cursive; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        h1 { margin: 20px; color: #4fc3f7; text-transform: uppercase; letter-spacing: 2px; }

        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; width: 100%; position: relative; }

        .game-tube {
            width: 80px; height: 400px; border: 4px solid #78909c; border-top: none;
            background: rgba(255,255,255,0.05); border-radius: 0 0 20px 20px;
            display: flex; flex-direction: column-reverse; align-items: center; padding-bottom: 5px;
            position: relative; overflow: hidden;
        }

        .orb {
            width: 60px; height: 60px; border-radius: 50%; border: 3px solid rgba(255,255,255,0.3);
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.5), 0 0 10px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
            margin-bottom: 2px; z-index: 10;
        }
        
        .shooter-area {
            width: 100%; padding: 20px; display: flex; gap: 20px; justify-content: center; background: #263238; margin-top: 20px;
            border-top: 2px solid #546e7a;
        }
        
        .ammo-btn {
            width: 70px; height: 70px; border-radius: 50%; border: none; cursor: pointer;
            transition: transform 0.1s; box-shadow: 0 5px 0 rgba(0,0,0,0.5); font-family: 'Fredoka One'; font-size: 1.2rem; color: #fff; text-shadow: 1px 1px 0 #000;
        }
        .ammo-btn:active { transform: translateY(5px); box-shadow: none; }
        /* Colors */
        .red { background: #ff5252; }
        .blue { background: #448aff; }
        .green { background: #69f0ae; }
        .yellow { background: #ffd740; }

        #msg { position: absolute; top: 50px; font-size: 1.5rem; text-shadow: 0 0 10px #000; pointer-events: none; }
        
        .explosion {
            position: absolute; width: 100px; height: 100px; background: radial-gradient(circle, #fff, transparent);
            opacity: 0; pointer-events: none; z-index: 20; transform: scale(0.5);
        }
        .boom { animation: boom 0.4s ease-out forwards; }
        @keyframes boom { 0%{opacity:1; transform:scale(0.5)} 100%{opacity:0; transform:scale(2)} }

    </style>
</head>
<body>
<h1>STK-003 Orb Blaster</h1>
<div id="msg">Match colored orbs to clear them! (Deduplication)</div>

<main>
    <div class="game-tube" id="tube"></div>

    <div class="shooter-area">
        <button class="ammo-btn red" onclick="game.shoot('R', '#ff5252')">R</button>
        <button class="ammo-btn blue" onclick="game.shoot('B', '#448aff')">B</button>
        <button class="ammo-btn green" onclick="game.shoot('G', '#69f0ae')">G</button>
        <button class="ammo-btn yellow" onclick="game.shoot('Y', '#ffd740')">Y</button>
    </div>
</main>

<div class="explosion" id="vfx"></div>

<script>
class Game {
    constructor() {
        this.stack = []; 
        this.ui = { tube: document.getElementById('tube'), msg: document.getElementById('msg'), vfx: document.getElementById('vfx') };
    }

    shoot(type, color) {
        if(this.stack.length >= 6 && this.stack[this.stack.length-1].type !== type) {
            this.msg("Tube Full! Match the top orb to clear space.");
            return;
        }

        // Check top
        let top = this.stack.length > 0 ? this.stack[this.stack.length-1] : null;

        if (top && top.type === type) {
            // Match -> Explode Both
            this.explode(top.el, color);
            
            // Remove top from visual
            top.el.remove();
            this.stack.pop();
            
            this.msg("BLAST! Duo Cleared.");
        } else {
            // No Match -> Push
            let orb = document.createElement('div');
            orb.className = 'orb';
            orb.style.backgroundColor = color;
            orb.innerText = type;
            
            // Drop animation handled by flex-reverse & DOM append order?
            // Actually flex-col-reverse fills from bottom. 
            // Need animation.
            orb.style.animation = "dropIn 0.3s ease-out";
            
            this.ui.tube.appendChild(orb);
            this.stack.push({type, color, el: orb});
            this.msg("");
        }
    }

    explode(targetEl, color) {
        // Visual boom at target location
        let rect = targetEl.getBoundingClientRect();
        let boom = this.ui.vfx;
        
        boom.style.left = (rect.left - 20) + 'px';
        boom.style.top = (rect.top - 20) + 'px';
        boom.style.background = `radial-gradient(circle, ${color}, transparent)`;
        
        // Remove class to reset anim
        boom.classList.remove('boom');
        void boom.offsetWidth; 
        boom.classList.add('boom');
    }

    msg(t) { this.ui.msg.innerText = t; }
}

const style = document.createElement('style');
style.innerHTML = `@keyframes dropIn { from{transform:translateY(-200px); opacity:0} to{transform:translateY(0); opacity:1} }`;
document.head.appendChild(style);

const game = new Game();
</script>
</body>
</html>
