<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STK-012: Rail Yard Switch</title>
    <link href="https://fonts.googleapis.com/css2?family=Crete+Round&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #3e2723; --rail: #795548; --track: #5d4037; --car: #ffca28; --op: #ef5350; }
        * { box-sizing: border-box; }
        body { font-family: 'Crete Round', serif; background: var(--bg); color: #fff; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow: hidden; }

        header { padding: 20px; font-size: 1.5rem; text-shadow: 2px 2px #000; }

        .yard {
            position: relative; width: 800px; height: 400px; background: #2e1c19; border: 5px solid #4e342e;
            border-radius: 10px; margin-top: 20px; overflow: hidden;
        }

        .track {
            position: absolute; height: 10px; background: #000; border-top: 2px solid #8d6e63;
        }
        /* Layout: Input (Top Left) -> Siding (Bottom Center) -> Output (Top Right) */
        
        .track-in { top: 100px; left: 0; width: 350px; transform: rotate(10deg); transform-origin: left; }
        .track-siding { bottom: 0; left: 380px; width: 40px; height: 200px; background: #444; } /* Vertical stack */
        .track-out { top: 100px; right: 0; width: 350px; transform: rotate(-10deg); transform-origin: right; }

        .train-car {
            position: absolute; width: 50px; height: 40px; background: var(--car);
            display: flex; align-items: center; justify-content: center; color: #000; font-weight: bold; border: 2px solid #fff;
            border-radius: 5px; transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1); font-size: 1.2rem;
            z-index: 10;
        }
        .train-car.op { background: var(--op); color: #fff; }

        .controls { display: flex; gap: 20px; margin-top: 30px; }
        .btn { padding: 15px 30px; font-size: 1.2rem; border-radius: 5px; cursor: pointer; border: none; background: #8d6e63; color: #fff; font-family: inherit; }
        .btn:hover { background: #a1887f; }

        #msg { position: absolute; top: 10px; width: 100%; text-align: center; color: #aaa; pointer-events: none; }
    </style>
</head>
<body>
<header>STK-012 RAIL YARD SWITCH (Shunting Yard)</header>

<div class="yard" id="yard">
    <div id="msg">Route incoming cars: Numbers -> Output, Ops -> Siding (Stack)</div>
    <div class="track track-in"></div>
    <div class="track track-siding"></div>
    <div class="track track-out"></div>
    <!-- Cars injected here -->
</div>

<div class="controls">
    <button class="btn" onclick="game.move('output')">DIRECT TO OUTPUT</button>
    <button class="btn" onclick="game.move('stack')">PUSH TO SIDING</button>
    <button class="btn" onclick="game.move('pop')">POP FROM SIDING</button>
</div>

<script>
class Game {
    constructor() {
        this.queue = ['A', '+', 'B', '*', 'C']; // Simple expr
        this.stack = [];
        this.output = [];
        this.currentCar = null;
        this.ui = { yard: document.getElementById('yard'), msg: document.getElementById('msg') };
        
        this.spawnNext();
    }

    spawnNext() {
        if(this.queue.length === 0) {
            this.msg("Input Empty! Clear the siding to finish.");
            return;
        }
        
        let val = this.queue.shift();
        this.currentCar = { val, el: this.createCar(val), state: 'input' };
        // Animate entrance
        this.currentCar.el.style.left = '50px';
        this.currentCar.el.style.top = '120px';
    }

    createCar(val) {
        let el = document.createElement('div');
        el.className = 'train-car ' + (['+','*'].includes(val) ? 'op' : '');
        el.innerText = val;
        el.style.left = '-60px'; // offscreen
        el.style.top = '120px';
        this.ui.yard.appendChild(el);
        return el;
    }

    move(action) {
        if (action === 'pop') {
            if(this.stack.length === 0) return;
            let car = this.stack.pop();
            this.moveToOutput(car);
            return;
        }

        if (!this.currentCar) return;

        if (action === 'output') {
            this.moveToOutput(this.currentCar);
            this.currentCar = null;
            setTimeout(() => this.spawnNext(), 600);
        } else if (action === 'stack') {
            this.moveToStack(this.currentCar);
            this.currentCar = null;
            setTimeout(() => this.spawnNext(), 600);
        }
    }

    moveToOutput(car) {
        // Output track coords
        let outX = 600 + this.output.length * 55;
        let outY = 120;
        
        car.el.style.left = outX + 'px';
        car.el.style.top = outY + 'px';
        this.output.push(car);
    }

    moveToStack(car) {
        // Siding coords
        let sX = 375;
        let sY = 350 - this.stack.length * 45;
        
        car.el.style.left = sX + 'px';
        car.el.style.top = sY + 'px';
        this.stack.push(car);
    }

    msg(t) { this.ui.msg.innerText = t; }
}
const game = new Game();
</script>
</body>
</html>
