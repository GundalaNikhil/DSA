<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STK-005: Grappling Hook</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0d0d0d; --pillar: #424242; --hook: #ff3d00; --rope: #eeeeee; --sky: #263238; }
        * { box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); color: #fff; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; user-select: none; }
        
        header { width: 100%; padding: 15px; text-align: center; border-bottom: 2px solid #333; }
        h1 { font-family: 'Black Ops One', cursive; font-size: 2rem; color: #ff3d00; margin: 0; }

        .game-viewport {
            width: 100%; max-width: 900px; height: 500px; background: var(--sky);
            position: relative; overflow: hidden; margin-top: 20px; border: 2px solid #555;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .pillar {
            position: absolute; bottom: 0; width: 40px; background: linear-gradient(to right, #424242, #616161);
            border-top: 5px solid #000; cursor: pointer; transition: filter 0.2s;
        }
        .pillar:hover { filter: brightness(1.3); }
        .pillar.selected { filter: sepia(100%) hue-rotate(-50deg) saturate(300%); box-shadow: 0 0 20px #ff3d00; }

        .hook-head {
            position: absolute; width: 20px; height: 20px; background: var(--hook);
            border-radius: 50%; display: none; z-index: 10;
        }
        
        .rope-line {
            position: absolute; height: 2px; background: var(--rope); transform-origin: left center; z-index: 5;
        }
        
        .hero {
            position: absolute; width: 30px; height: 40px; background: #00e676; border: 2px solid #fff;
            transition: all 0.5s; z-index: 20;
        }
        
        #res { font-family: 'Black Ops One'; font-size: 1.2rem; color: #ff3d00; position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; }

        .controls { margin-top: 20px; display: flex; gap: 20px; }
        .btn { padding: 10px 20px; background: #333; color: #fff; border: 1px solid #fff; cursor: pointer; font-family: 'Black Ops One'; }
        .btn:hover { background: #555; }

    </style>
</head>
<body>
<header>
    <h1>STK-005 GRAPPLING HOOK</h1>
    <div style="font-size:0.9rem;">Find Next Greater Height (NGE)</div>
</header>

<div class="game-viewport" id="view">
    <div id="res">Click on a pillar to fire grappling hook!</div>
    <div class="hero" id="hero" style="left:100px; bottom: 300px;"></div>
    <!-- Pillars generated by JS -->
    <div class="hook-head" id="hook"></div>
    <div class="rope-line" id="rope"></div>
</div>

<div class="controls">
    <button class="btn" onclick="game.regen()">NEW TERRAIN</button>
</div>

<script>
class Game {
    constructor() {
        this.n = 12;
        this.pillars = [];
        this.ui = { view: document.getElementById('view'), hero: document.getElementById('hero'), hook: document.getElementById('hook'), rope: document.getElementById('rope'), res: document.getElementById('res') };
        this.regen();
        
        // Stack logic just for finding correct target mathematically, visuals are direct
        // NGE Monotonic Stack
    }

    regen() {
        this.pillars = [];
        // Clear DOM except hero/hook/rope/res
        let bad = this.ui.view.querySelectorAll('.pillar');
        bad.forEach(b => b.remove());
        
        let w = 800 / this.n;
        for(let i=0; i<this.n; i++) {
            let h = Math.floor(Math.random()*300) + 50;
            this.pillars.push(h);
            
            let p = document.createElement('div');
            p.className = 'pillar';
            p.style.height = h + 'px';
            p.style.left = (50 + i * w) + 'px';
            p.style.width = (w - 10) + 'px';
            p.onclick = () => this.fireHook(i);
            
            this.ui.view.appendChild(p);
        }
        
        // Initial hero Pos
        this.placeHero(0);
    }
    
    placeHero(idx) {
        let p = this.ui.view.querySelectorAll('.pillar')[idx];
        let rect = p.getBoundingClientRect();
        let viewRect = this.ui.view.getBoundingClientRect();
        
        this.ui.hero.style.left = (rect.left - viewRect.left + rect.width/2 - 15) + 'px';
        this.ui.hero.style.bottom = (this.pillars[idx]) + 'px';
    }

    async fireHook(idx) {
        this.ui.rope.style.width = '0px';
        this.ui.hook.style.display = 'none';
        
        let startH = this.pillars[idx];
        let startEl = this.ui.view.querySelectorAll('.pillar')[idx];
        
        // Visual Hero Move
        this.placeHero(idx);
        startEl.classList.add('selected');
        
        // Find NGE
        let found = -1;
        for(let i = idx + 1; i < this.n; i++) {
            if (this.pillars[i] > startH) {
                found = i;
                break;
            }
        }
        
        // Fire animation
        this.ui.res.innerText = "FIRING HOOK...";
        let viewRect = this.ui.view.getBoundingClientRect();
        let startRect = startEl.getBoundingClientRect();
        
        let x1 = startRect.left - viewRect.left + startRect.width/2;
        let y1 = viewRect.height - startH;
        
        // Determine target X (either found pillar or off screen)
        let targetX = found !== -1 ? (this.ui.view.querySelectorAll('.pillar')[found].getBoundingClientRect().left - viewRect.left) : (viewRect.width + 50);
        let targetY = found !== -1 ? (viewRect.height - this.pillars[found]) : y1;

        // Animate Line
        this.ui.rope.style.left = x1 + 'px';
        this.ui.rope.style.top = y1 + 'px';
        this.ui.rope.style.transform = `rotate(${Math.atan2(targetY - y1, targetX - x1)}rad)`;
        
        let dist = Math.sqrt(Math.pow(targetX - x1, 2) + Math.pow(targetY - y1, 2));
        
        // Animate width
        this.ui.rope.style.transition = "width 0.5s linear";
        this.ui.rope.style.width = dist + 'px';
        
        await new Promise(r => setTimeout(r, 600));
        
        if (found !== -1) {
            this.ui.res.innerText = `GRAPPLE SUCCESS! Next Greater Height: ${this.pillars[found]}`;
            // Zip animation?
        } else {
             this.ui.res.innerText = "MISS! No taller structure ahead.";
             // Reset rope
             this.ui.rope.style.width = '0px';
        }
        
        setTimeout(() => startEl.classList.remove('selected'), 1000);
    }
}
const game = new Game();
</script>
</body>
</html>
